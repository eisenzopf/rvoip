/* ITU G.722 3rd Edition (2012-09) */

/*-----------------------------------------------------------------------------------
 ITU-T G.722-SWBS / G.722 Annex D - Reference C code for fixed-point implementation          
 Version 1.0
 Copyright (c) 2012,
 Huawei Technologies
-----------------------------------------------------------------------------------*/

/*--------------------------------------------------------------------------
 ITU-T Annex B (ex G.722-SWB) Source Code
 Software Release 1.00 (2010-09)
 (C) 2010 France Telecom, Huawei Technologies, NTT, VoiceAge Corp.
--------------------------------------------------------------------------*/

#include "stl.h"
#include "bwe_mdct.h"

/***********************************************/
#define MDCT2_SBARYSZ (1 << (MDCT2_EXP_NPP-1))   
/* MDCT window, Q14 */
Word16 MDCT_h_swb[MDCT2_L_WIN2] = {
   227,   682,  1137,  1591,  2045,  2497,  2949,  3400,  3849,  4297,
  4743,  5188,  5630,  6070,  6508,  6943,  7376,  7806,  8233,  8656,
  9077,  9494,  9907, 10316, 10721, 11123, 11520, 11912, 12300, 12683,
 13061, 13435, 13803, 14165, 14523, 14874, 15220, 15560, 15894, 16222,
 16544, 16859, 17168, 17470, 17766, 18054, 18336, 18611, 18878, 19138,
 19391, 19636, 19874, 20104, 20326, 20541, 20747, 20946, 21136, 21319,
 21493, 21659, 21816, 21965, 22106, 22238, 22361, 22476, 22582, 22680,
 22769, 22849, 22920, 22982, 23035, 23080, 23116, 23143, 23160, 23169
};

/* Sine table for MDCT and iMDCT, Q15 */
const Word16 MDCT_wsin_swb[MDCT2_L_WIN4+1] = {   
     0,  1286,  2571,  3851,  5126,  6393,  7650,  8895, 10126, 11342,
 12540, 13719, 14876, 16011, 17121, 18205, 19261, 20286, 21281, 22243,
 23170, 24062, 24917, 25733, 26510, 27246, 27939, 28590, 29197, 29758,
 30274, 30743, 31164, 31538, 31863, 32138, 32365, 32541, 32667, 32743,
 32767
};

/* Table for complex post-multiplication in MDCT (real part), Q21 */
const Word16 MDCT_wetr_swb[MDCT2_L_WIN4] = {
  -9359,   9712, -10050,  10372, -10679,  10969, -11242,  11498, -11736,  11957,
 -12158,  12341, -12505,  12649, -12774,  12880, -12965,  13031, -13076,  13102,
 -13107,  13091, -13056,  13001, -12925,  12830, -12714,  12580, -12425,  12252,
 -12060,  11849, -11620,  11373, -11108,  10826, -10528,  10213,  -9883,   9537
};

/* Table for complex post-multiplication in MDCT (imaginary part), Q21 */
const Word16 MDCT_weti_swb[MDCT2_L_WIN4] = {
   9177,  -8802,   8414,  -8013,   7600,  -7175,   6738,  -6292,   5836,  -5370,
   4897,  -4416,   3928,  -3434,   2935,  -2431,   1923,  -1413,    900,   -386,
   -129,    643,  -1157,   1668,  -2177,   2683,  -3185,   3681,  -4173,   4657,
  -5135,   5604,  -6065,   6516,  -6958,   7389,  -7808,   8215,  -8610,   8991,
};

/* Index mapping table for Good-Thomas FFT */
const Word16 MDCT_tab_map_swb[MDCT2_NP*MDCT2_NPP] = {   
 0, 25, 10, 35, 20,  5, 30, 15,
16,  1, 26, 11, 36, 21,  6, 31,
32, 17,  2, 27, 12, 37, 22,  7,
 8, 33, 18,  3, 28, 13, 38, 23,
24,  9, 34, 19,  4, 29, 14, 39
};

/* Index mapping table for Good-Thomas FFT */
const Word16 MDCT_tab_map2_swb[MDCT2_NP*MDCT2_NPP] = {   
 0,  5, 10, 15, 20, 25, 30, 35,
 8, 13, 18, 23, 28, 33, 38,  3,
16, 21, 26, 31, 36,  1,  6, 11,
24, 29, 34, 39,  4,  9, 14, 19,
32, 37,  2,  7, 12, 17, 22, 27,
};

/* Table for Good-Thomas FFT */
const Word16 MDCT_tab_rev_ipp_swb[MDCT2_NB_REV] = { 1, 3 };

/* Table for Good-Thomas FFT */
const Word16 MDCT_tab_rev_i_swb[MDCT2_NB_REV] = { 4, 6 };

/* FFT twiddle factors (cosine part), Q15 */
const Word16 MDCT_rw1_tbl_swb[MDCT2_SBARYSZ] = {  32767,  23170,      0, -23170 };

/* FFT twiddle factors (sine part), Q15 */
const Word16 MDCT_rw2_tbl_swb[MDCT2_SBARYSZ] = {      0,  23170,  32767,  23170 };

const Word16 MDCT_rw2_tbl_swb_n[MDCT2_SBARYSZ] = { 0,  -23170, -32767, -23170 };

/* Cosine table for FFT, Q15 */
const Word16 MDCT_xcos_swb[MDCT2_NP*MDCT2_NP] = {   
 32767,  32767,  32767,  32767,  32767,
 32767,  10126, -26510, -26510,  10126,
 32767, -26510,  10126,  10126, -26510,
 32767, -26510,  10126,  10126, -26510,
 32767,  10126, -26510, -26510,  10126
};

/* Sine table for FFT, Q15 */
const Word16 MDCT_xsin_swb[MDCT2_NP*MDCT2_NP] = {   
     0,      0,      0,      0,      0,
     0, -31164, -19261,  19261,  31164,
     0, -19261,  31164, -31164,  19261,
     0,  19261, -31164,  31164, -19261,
     0,  31164,  19261, -19261, -31164
};

/* Table for complex pre-multiplication in iMDCT (real part), Q14 */
const Word16 MDCT_wetrm1_swb[MDCT2_L_WIN4] = {
 -23397,  24279, -25125,  25931, -26698,  27423, -28106,  28746, -29341,  29891,
 -30395,  30853, -31262,  31624, -31936,  32200, -32413,  32577, -32691,  32754,
 -32766,  32729, -32640,  32501, -32313,  32074, -31786,  31449, -31063,  30630,
 -30149,  29622, -29049,  28431, -27770,  27066, -26320,  25533, -24707,  23843
};

/* Table for complex pre-multiplication in iMDCT (imaginary part), Q14 */
const Word16 MDCT_wetim1_swb[MDCT2_L_WIN4] = {
 -22942,  22006, -21035,  20033, -18999,  17937, -16846,  15730, -14589,  13426,
 -12242,  11039,  -9819,   8585,  -7336,   6077,  -4808,   3532,  -2250,    965,
    322,  -1608,   2892,  -4171,   5444,  -6708,   7962,  -9204,  10431, -11643,
  12836, -14010,  15162, -16291,  17395, -18472,  19520, -20538,  21525, -22478
};

/***********************************************/
Word16 sgain[MAX_HB_ENH_BITS+1][MAX_NCB_GAIN] = { /* Q14 */   
{ 16384,     0,     0,     0,     0,     0,     0,     0},
{ 16384,  3277,     0,     0,     0,     0,     0,     0},
{ 16384, 20626, 13014,  3277,     0,     0,     0,     0},
{ 16384, 18383, 20626, 23143, 14602, 13014, 11599,  3277}
};

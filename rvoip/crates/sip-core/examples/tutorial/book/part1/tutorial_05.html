<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SIP Responses in Depth</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sip-responses-in-depth"><a class="header" href="#sip-responses-in-depth">SIP Responses in Depth</a></h1>
<p>In this tutorial, we'll explore SIP responses - the messages sent by servers and user agents in reply to SIP requests. Building on what we've learned about the builder pattern, we'll look at the structure, categories, and common types of SIP responses, and implement them using the <code>rvoip-sip-core</code> library.</p>
<h2 id="sip-response-structure"><a class="header" href="#sip-response-structure">SIP Response Structure</a></h2>
<p>A SIP response consists of:</p>
<ol>
<li><strong>Status Line</strong>: Contains the SIP version, status code, and a reason phrase</li>
<li><strong>Headers</strong>: Various headers providing information about the response</li>
<li><strong>Message Body</strong> (optional): Contains additional data like SDP for media negotiation</li>
</ol>
<p>The status line format is:</p>
<pre><code>SIP/2.0 [Status Code] [Reason Phrase]
</code></pre>
<p>For example:</p>
<pre><code>SIP/2.0 200 OK
</code></pre>
<h2 id="response-categories"><a class="header" href="#response-categories">Response Categories</a></h2>
<p>SIP responses are grouped into six categories based on their status codes:</p>
<div class="table-wrapper"><table><thead><tr><th>Category</th><th>Range</th><th>Description</th></tr></thead><tbody>
<tr><td>Provisional</td><td>1xx</td><td>Request received and being processed</td></tr>
<tr><td>Success</td><td>2xx</td><td>Request was successfully received, understood, and accepted</td></tr>
<tr><td>Redirection</td><td>3xx</td><td>Further action needs to be taken to complete the request</td></tr>
<tr><td>Client Error</td><td>4xx</td><td>The request contains bad syntax or cannot be fulfilled at this server</td></tr>
<tr><td>Server Error</td><td>5xx</td><td>The server failed to fulfill a valid request</td></tr>
<tr><td>Global Failure</td><td>6xx</td><td>The request cannot be fulfilled at any server</td></tr>
</tbody></table>
</div>
<p>Let's examine each category and how to create responses using the <code>ResponseBuilder</code> in <code>rvoip-sip-core</code>.</p>
<h2 id="1xx---provisional-responses"><a class="header" href="#1xx---provisional-responses">1xx - Provisional Responses</a></h2>
<p>Provisional responses indicate that a request has been received and is being processed, but no final determination has been made. Common 1xx responses include:</p>
<ul>
<li><strong>100 Trying</strong>: The request has been received and is being processed</li>
<li><strong>180 Ringing</strong>: The destination user agent has received the INVITE and is alerting the user</li>
<li><strong>183 Session Progress</strong>: Used to convey information about the progress of the call that's not otherwise classified</li>
</ul>
<h3 id="100-trying-response"><a class="header" href="#100-trying-response">100 Trying Response</a></h3>
<p>The 100 Trying response is typically sent by a proxy server to indicate that it has received the request and is working on routing it. It stops retransmissions of the request and is not forwarded to other servers.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::Trying, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .build();
<span class="boring">}</span></code></pre></pre>
<p>Note that a 100 Trying response doesn't include a Contact header, as it's typically generated by intermediaries.</p>
<h3 id="180-ringing-response"><a class="header" href="#180-ringing-response">180 Ringing Response</a></h3>
<p>The 180 Ringing response indicates that the destination user agent has received the INVITE and is alerting the user (e.g., playing a ringtone).</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::Ringing, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .contact("sip:bob@biloxi.example.com", None)
    .build();
<span class="boring">}</span></code></pre></pre>
<h3 id="183-session-progress-with-early-media"><a class="header" href="#183-session-progress-with-early-media">183 Session Progress with Early Media</a></h3>
<p>The 183 Session Progress response is often used to send early media (like ringback tones or announcements) before the call is answered. It typically includes an SDP body.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Create SDP for early media
let sdp = SdpBuilder::new("Session Progress")
    .origin("bob", "2890844527", "2890844527", "IN", "IP4", "biloxi.example.com")
    .connection("IN", "IP4", "biloxi.example.com") 
    .time("0", "0")
    .media_audio(49172, "RTP/AVP")
        .formats(&amp;["0"])
        .rtpmap("0", "PCMU/8000")
        .direction(MediaDirection::SendOnly) // One-way early media
        .done()
    .build()?;

let require = Require::with_tag("100rel");

let response = ResponseBuilder::new(StatusCode::SessionProgress, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .contact("sip:bob@biloxi.example.com", None)
    .content_type("application/sdp")
    .header(TypedHeader::Require(require)) // Requires reliable provisional responses
    .rseq(1) // RSeq header for reliability
    .body(sdp.to_string())
    .build();
<span class="boring">}</span></code></pre></pre>
<p>The <code>100rel</code> extension (RFC 3262) provides reliability for provisional responses, which is important when they contain SDP. The RSeq header is used in conjunction with PRACK requests to confirm receipt of reliable provisional responses.</p>
<h2 id="2xx---success-responses"><a class="header" href="#2xx---success-responses">2xx - Success Responses</a></h2>
<p>Success responses indicate that a request was successfully received, understood, and accepted. The most common 2xx response is 200 OK.</p>
<h3 id="200-ok-response-to-invite"><a class="header" href="#200-ok-response-to-invite">200 OK Response to INVITE</a></h3>
<p>A 200 OK response to an INVITE includes an SDP answer and establishes a session.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Create SDP answer
let sdp = SdpBuilder::new("Call with Alice")
    .origin("bob", "2890844527", "2890844527", "IN", "IP4", "biloxi.example.com")
    .connection("IN", "IP4", "biloxi.example.com") 
    .time("0", "0")
    .media_audio(49172, "RTP/AVP")
        .formats(&amp;["0"])
        .rtpmap("0", "PCMU/8000")
        .direction(MediaDirection::SendRecv)
        .done()
    .build()?;

let response = ResponseBuilder::new(StatusCode::Ok, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .contact("sip:bob@biloxi.example.com", None)
    .content_type("application/sdp")
    .allow_methods(vec![
        Method::Invite,
        Method::Ack,
        Method::Cancel,
        Method::Bye,
        Method::Refer,
        Method::Notify,
        Method::Options
    ])
    .supported_tags(vec![
        "replaces".to_string(),
        "100rel".to_string()
    ])
    .session_expires(3600, Some(Refresher::Uas))
    .body(sdp.to_string())
    .build();
<span class="boring">}</span></code></pre></pre>
<p>Important headers for 200 OK responses to INVITE:</p>
<ul>
<li><strong>Contact</strong>: Where subsequent requests in the dialog should be sent</li>
<li><strong>Allow</strong>: Lists methods supported by the UA</li>
<li><strong>Supported</strong>: Lists SIP extensions supported by the UA</li>
<li><strong>Session-Expires</strong>: Session refresh interval and refresher role</li>
</ul>
<h3 id="202-accepted-response"><a class="header" href="#202-accepted-response">202 Accepted Response</a></h3>
<p>The 202 Accepted response is typically used for asynchronous operations like SUBSCRIBE requests.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::Accepted, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("7a9f2f899ndf98f7a8fd9f890as87f9a")
    .cseq(1, Method::Subscribe)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .contact("sip:bob@biloxi.example.com", None)
    .expires_seconds(3600) // How long the subscription is accepted for
    .build();
<span class="boring">}</span></code></pre></pre>
<p>For SUBSCRIBE requests, the Expires header indicates how long the subscription is valid.</p>
<h2 id="3xx---redirection-responses"><a class="header" href="#3xx---redirection-responses">3xx - Redirection Responses</a></h2>
<p>Redirection responses indicate that further action needs to be taken to complete the request. They typically contain a Contact header with an alternative address.</p>
<h3 id="302-moved-temporarily-response"><a class="header" href="#302-moved-temporarily-response">302 Moved Temporarily Response</a></h3>
<p>The 302 Moved Temporarily response indicates that the user is temporarily available at a different address.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::MovedTemporarily, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .contact("sip:bob@chicago.example.com", None) // New contact address
    .expires_seconds(1800) // For how long this redirection is valid
    .build();
<span class="boring">}</span></code></pre></pre>
<p>The Contact header in a redirection response contains the new address where the request should be directed. The Expires header (if present) indicates how long the redirection is valid.</p>
<h3 id="305-use-proxy-response"><a class="header" href="#305-use-proxy-response">305 Use Proxy Response</a></h3>
<p>The 305 Use Proxy response indicates that the request should be sent through a specific proxy.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::UseProxy, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .contact("sip:proxy.biloxi.example.com", None) // Proxy address
    .build();
<span class="boring">}</span></code></pre></pre>
<h2 id="4xx---client-error-responses"><a class="header" href="#4xx---client-error-responses">4xx - Client Error Responses</a></h2>
<p>Client error responses indicate that the request contains bad syntax or cannot be fulfilled at the server. The client should modify the request before retrying.</p>
<h3 id="400-bad-request-response"><a class="header" href="#400-bad-request-response">400 Bad Request Response</a></h3>
<p>The 400 Bad Request response indicates that the request was malformed or contained an invalid parameter.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::BadRequest, Some("Missing Required Header"))
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .build();
<span class="boring">}</span></code></pre></pre>
<p>Note the optional reason phrase parameter in the constructor, which allows you to provide a specific reason for the error.</p>
<h3 id="401-unauthorized-response"><a class="header" href="#401-unauthorized-response">401 Unauthorized Response</a></h3>
<p>The 401 Unauthorized response indicates that authentication credentials are required. It includes a WWW-Authenticate header with challenge information.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::Unauthorized, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .www_authenticate_digest(
        "biloxi.example.com",                  // realm
        "dcd98b7102dd2f0e8b11d0f600bfb0c093",  // nonce
        Some("auth"),                          // qop
        Some("MD5"),                           // algorithm
        Some(vec!["5ccc069c403ebaf9f0171e9517f40e41"]), // opaque
        None,                                  // stale
        None                                   // domain
    )
    .build();
<span class="boring">}</span></code></pre></pre>
<p>The WWW-Authenticate header provides parameters for the client to use in formulating an authentication response.</p>
<h3 id="403-forbidden-response"><a class="header" href="#403-forbidden-response">403 Forbidden Response</a></h3>
<p>The 403 Forbidden response indicates that the server understood the request but refuses to fulfill it.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::Forbidden, Some("User blocked"))
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .build();
<span class="boring">}</span></code></pre></pre>
<h3 id="404-not-found-response"><a class="header" href="#404-not-found-response">404 Not Found Response</a></h3>
<p>The 404 Not Found response indicates that the server has definitive information that the user does not exist at the domain specified in the Request-URI.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::NotFound, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .build();
<span class="boring">}</span></code></pre></pre>
<h3 id="406-not-acceptable-response"><a class="header" href="#406-not-acceptable-response">406 Not Acceptable Response</a></h3>
<p>The 406 Not Acceptable response indicates that the server cannot generate a response that matches the Accept header criteria in the request.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::NotAcceptable, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .accept("application/sdp", None) // Only accept SDP
    .build();
<span class="boring">}</span></code></pre></pre>
<h3 id="486-busy-here-response"><a class="header" href="#486-busy-here-response">486 Busy Here Response</a></h3>
<p>The 486 Busy Here response indicates that the user is currently busy and cannot take the call.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::BusyHere, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .retry_after_with_comment(60, "User in another call") // Try again in 1 minute
    .build();
<span class="boring">}</span></code></pre></pre>
<p>The Retry-After header suggests when the client should try the request again.</p>
<h2 id="5xx---server-error-responses"><a class="header" href="#5xx---server-error-responses">5xx - Server Error Responses</a></h2>
<p>Server error responses indicate that the server failed to fulfill an apparently valid request.</p>
<h3 id="500-server-internal-error-response"><a class="header" href="#500-server-internal-error-response">500 Server Internal Error Response</a></h3>
<p>The 500 Server Internal Error response indicates that the server encountered an unexpected condition that prevented it from fulfilling the request.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::ServerInternalError, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .retry_after_duration(300, 0, Some("Server maintenance")) // Retry after 5 minutes
    .build();
<span class="boring">}</span></code></pre></pre>
<h3 id="503-service-unavailable-response"><a class="header" href="#503-service-unavailable-response">503 Service Unavailable Response</a></h3>
<p>The 503 Service Unavailable response indicates that the server is temporarily unable to handle the request due to overload or maintenance.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::ServiceUnavailable, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .retry_after(120) // Retry after 2 minutes
    .build();
<span class="boring">}</span></code></pre></pre>
<h2 id="6xx---global-failure-responses"><a class="header" href="#6xx---global-failure-responses">6xx - Global Failure Responses</a></h2>
<p>Global failure responses indicate that the request cannot be fulfilled at any server.</p>
<h3 id="603-decline-response"><a class="header" href="#603-decline-response">603 Decline Response</a></h3>
<p>The 603 Decline response indicates that the user explicitly does not wish to participate in the call.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let response = ResponseBuilder::new(StatusCode::Decline, None)
    .from("Bob", "sip:bob@biloxi.example.com", None)
    .to("Alice", "sip:alice@atlanta.example.com", Some("9fxced76sl"))
    .call_id("3848276298220188511@atlanta.example.com")
    .cseq(314159, Method::Invite)
    .via("atlanta.example.com:5060", "UDP", Some("z9hG4bKnashds7"))
    .retry_after_with_comment(3600, "User unavailable") // Try again in 1 hour
    .build();
<span class="boring">}</span></code></pre></pre>
<h2 id="common-response-headers"><a class="header" href="#common-response-headers">Common Response Headers</a></h2>
<p>All SIP responses share a common set of headers:</p>
<ol>
<li><strong>From</strong>: Identifies the initiator of the request</li>
<li><strong>To</strong>: Identifies the intended recipient of the request</li>
<li><strong>Call-ID</strong>: Unique identifier for the call</li>
<li><strong>CSeq</strong>: Command sequence number and method</li>
<li><strong>Via</strong>: Indicates the path taken by the request</li>
</ol>
<p>Additional common headers include:</p>
<ol start="6">
<li><strong>Contact</strong>: Where subsequent requests should be sent</li>
<li><strong>Content-Type</strong>: Format of the message body</li>
<li><strong>Content-Length</strong>: Size of the message body in bytes</li>
<li><strong>Server</strong>: Information about the server software</li>
</ol>
<h2 id="creating-responses-from-requests"><a class="header" href="#creating-responses-from-requests">Creating Responses from Requests</a></h2>
<p>In real-world applications, responses are often created based on incoming requests. The <code>ResponseBuilder</code> provides convenience methods to create responses directly from requests:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let incoming_request = /* ... */;

// Create a 200 OK response
let ok_response = ResponseBuilder::response_from_request(incoming_request, StatusCode::Ok, None)
    .contact("sip:bob@biloxi.example.com", None)
    .build();

// Create a 404 Not Found response
let not_found = ResponseBuilder::response_from_request(incoming_request, StatusCode::NotFound, None)
    .build();
<span class="boring">}</span></code></pre></pre>
<p>This approach ensures that all necessary headers from the request are properly reflected in the response.</p>
<h2 id="response-processing"><a class="header" href="#response-processing">Response Processing</a></h2>
<p>When processing a response, a client should:</p>
<ol>
<li>Examine the status code to determine the outcome of the request</li>
<li>For 3xx responses, extract the Contact header to determine the new target</li>
<li>For 401/407 responses, extract authentication details to formulate a new request</li>
<li>For 2xx responses to INVITE, extract the SDP to establish the media session</li>
</ol>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>SIP responses are the other half of the request-response protocol model. Understanding how to generate and interpret different types of responses is essential for implementing SIP applications.</p>
<p>In the next tutorial, we'll move on to explore Session Description Protocol (SDP), which is a key component in establishing media sessions through SIP.</p>
<h2 id="exercises"><a class="header" href="#exercises">Exercises</a></h2>
<ol>
<li>Create a 180 Ringing response with a require header specifying "100rel" for reliable provisional responses.</li>
<li>Create a 407 Proxy Authentication Required response with appropriate challenge headers.</li>
<li>Create a 302 Moved Temporarily response with multiple Contact headers for load balancing.</li>
<li>Create a 420 Bad Extension response that indicates which extensions were not understood.</li>
<li>Create a 200 OK response to an OPTIONS request that includes comprehensive capability information.</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../part1/tutorial_04.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../part2/tutorial_06.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../part1/tutorial_04.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../part2/tutorial_06.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>

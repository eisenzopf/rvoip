warning: unused import: `StaticEvent`
  --> crates/infra-common/src/events/static_path.rs:14:60
   |
14 | use crate::events::types::{Event, EventResult, EventError, StaticEvent, EventFilter};
   |                                                            ^^^^^^^^^^^
   |
   = note: `#[warn(unused_imports)]` on by default

warning: unused imports: `EventError` and `StaticEvent`
  --> crates/infra-common/src/events/system.rs:16:48
   |
16 | use crate::events::types::{Event, EventResult, EventError, EventFilter, StaticEvent};
   |                                                ^^^^^^^^^^               ^^^^^^^^^^^

warning: unused imports: `EventSystemBuilder` and `ImplementationType`
  --> crates/infra-common/src/events/system.rs:21:30
   |
21 | use crate::events::builder::{ImplementationType, EventSystemBuilder};
   |                              ^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^

warning: variable does not need to be mutable
  --> crates/infra-common/src/lifecycle/manager.rs:87:13
   |
87 |         let mut components = self.components.write().unwrap();
   |             ----^^^^^^^^^^
   |             |
   |             help: remove this `mut`
   |
   = note: `#[warn(unused_mut)]` on by default

warning: variable does not need to be mutable
   --> crates/infra-common/src/lifecycle/manager.rs:107:13
    |
107 |         let mut components = self.components.write().unwrap();
    |             ----^^^^^^^^^^
    |             |
    |             help: remove this `mut`

warning: variable does not need to be mutable
   --> crates/infra-common/src/lifecycle/manager.rs:127:13
    |
127 |         let mut components = self.components.write().unwrap();
    |             ----^^^^^^^^^^
    |             |
    |             help: remove this `mut`

warning: variable does not need to be mutable
   --> crates/infra-common/src/lifecycle/manager.rs:148:13
    |
148 |         let mut components = self.components.write().unwrap();
    |             ----^^^^^^^^^^
    |             |
    |             help: remove this `mut`

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:63:20
   |
63 |             config.merge(File::from(base_path.clone()))
   |                    ^^^^^
   |
   = note: `#[warn(deprecated)]` on by default

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:69:20
   |
69 |             config.merge(File::from(env_path))
   |                    ^^^^^

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:75:16
   |
75 |         config.merge(Environment::with_prefix(&env_prefix).separator("__"))
   |                ^^^^^

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:97:16
   |
97 |         config.merge(Environment::with_prefix(&env_prefix).separator("__"))
   |                ^^^^^

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
   --> crates/infra-common/src/config/loader.rs:115:20
    |
115 |             config.merge(File::from(p.clone()))
    |                    ^^^^^

warning: methods `type_name` and `clone_sender` are never used
  --> crates/infra-common/src/events/registry.rs:37:8
   |
35 | trait AnyBroadcastSender: Send + Sync + 'static {
   |       ------------------ methods in this trait
36 |     fn as_any(&self) -> &dyn Any;
37 |     fn type_name(&self) -> &str;
   |        ^^^^^^^^^
38 |     fn clone_sender(&self) -> Box<dyn AnyBroadcastSender>;
   |        ^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` on by default

warning: fields `id`, `event_type`, and `priority` are never read
  --> crates/infra-common/src/events/subscriber.rs:11:16
   |
10 | pub struct SubscriberHandle {
   |            ---------------- fields in this struct
11 |     pub(crate) id: u64,
   |                ^^
12 |     pub(crate) event_type: EventType,
   |                ^^^^^^^^^^
13 |     pub(crate) priority: EventPriority,
   |                ^^^^^^^^
   |
   = note: `SubscriberHandle` has derived impls for the traits `Clone` and `Debug`, but these are intentionally ignored during dead code analysis

warning: method `handle_auto_options` is never used
   --> crates/dialog-core/src/manager/unified.rs:563:14
    |
197 | impl UnifiedDialogManager {
    | ------------------------- method in this implementation
...
563 |     async fn handle_auto_options(&self, request: Request, source: SocketAddr) -> ApiResult<()> {
    |              ^^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: method `extract_body_string` is never used
   --> crates/dialog-core/src/protocol/invite_handler.rs:177:8
    |
71  | impl DialogManager {
    | ------------------ method in this implementation
...
177 |     fn extract_body_string(&self, request: &Request) -> String {
    |        ^^^^^^^^^^^^^^^^^^^

warning: `infra-common` (lib) generated 14 warnings (run `cargo fix --lib -p infra-common` to apply 7 suggestions)
warning: `rvoip-dialog-core` (lib) generated 2 warnings
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.10s
     Running `/Users/jonathan/Documents/Work/Rudeless Ventures/rvoip/rvoip/target/debug/sip_test_server --port 5062 --mode auto-answer --log-level info`
[2m2025-06-09T03:32:33.588378Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m278:[0m 🧪 SIP Test Server starting...
[2m2025-06-09T03:32:33.588483Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m279:[0m 🔧 Configuration:
[2m2025-06-09T03:32:33.588495Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m280:[0m   📡 Port: 5062
[2m2025-06-09T03:32:33.588518Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m281:[0m   🎯 Mode: AutoAnswer
[2m2025-06-09T03:32:33.588528Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m282:[0m   📊 Metrics: true
[2m2025-06-09T03:32:33.588536Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m168:[0m 🚀 Starting SIP Test Server on port 5062
[2m2025-06-09T03:32:33.588941Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/api/unified.rs[0m[2m:[0m[2m805:[0m Creating UnifiedDialogApi with automatic transport setup in "Hybrid" mode
[2m2025-06-09T03:32:33.589422Z[0m [32m INFO[0m ThreadId(01) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m48:[0m SIP UDP transport bound to 127.0.0.1:5062
[2m2025-06-09T03:32:33.590101Z[0m [32m INFO[0m ThreadId(01) [2mcrates/transaction-core/src/transport/mod.rs[0m[2m:[0m[2m247:[0m Added UDP transport bound to 127.0.0.1:5062
[2m2025-06-09T03:32:33.590649Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/api/unified.rs[0m[2m:[0m[2m294:[0m Creating UnifiedDialogApi with global events in "Hybrid" mode
[2m2025-06-09T03:32:33.590707Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/unified.rs[0m[2m:[0m[2m252:[0m Creating UnifiedDialogManager with global events in "Hybrid" mode at 127.0.0.1:5062
[2m2025-06-09T03:32:33.590747Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/core.rs[0m[2m:[0m[2m100:[0m Creating new DialogManager with global transaction events and local address 127.0.0.1:5062
🔗 SETUP: Initializing dialog coordination via DialogCoordinator
🔗 SETUP: Setting up session coordination with dialog-core
[2m2025-06-09T03:32:33.591046Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/manager/core.rs[0m[2m:[0m[2m128:[0m 🔄 Starting global transaction event processor for dialog-core
✅ SETUP: Session coordination setup complete
🎬 SPAWN: Starting dialog coordination event loop
🎬 SPAWN: Starting session coordination event loop
🌉 BRIDGE: Setting up session event bridge with media auto-creation and SDP handling
📡 EVENT LOOP: Session coordination event loop started
[2m2025-06-09T03:32:33.591163Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m289:[0m SessionManager initialized on port 5062
[2m2025-06-09T03:32:33.591176Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m197:[0m 🚀 Starting SIP Test Server session manager...
[2m2025-06-09T03:32:33.591185Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/api/unified.rs[0m[2m:[0m[2m336:[0m Starting UnifiedDialogApi
[2m2025-06-09T03:32:33.591193Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/unified.rs[0m[2m:[0m[2m294:[0m Starting UnifiedDialogManager in "Hybrid" mode
[2m2025-06-09T03:32:33.591201Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/core.rs[0m[2m:[0m[2m399:[0m DialogManager starting
[2m2025-06-09T03:32:33.591209Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/core.rs[0m[2m:[0m[2m407:[0m DialogManager started successfully
[2m2025-06-09T03:32:33.591217Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/unified.rs[0m[2m:[0m[2m310:[0m Hybrid mode active - from_uri: Some("sip:test@127.0.0.1:5062"), domain: None, auto_auth: false, auto_options: false
[2m2025-06-09T03:32:33.591225Z[0m [32m INFO[0m ThreadId(01) [2mcrates/dialog-core/src/manager/unified.rs[0m[2m:[0m[2m315:[0m UnifiedDialogManager started successfully
[2m2025-06-09T03:32:33.591238Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/src/manager/events.rs[0m[2m:[0m[2m141:[0m Session event processor started
[2m2025-06-09T03:32:33.591267Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/src/manager/cleanup.rs[0m[2m:[0m[2m54:[0m Cleanup manager started
[2m2025-06-09T03:32:33.591277Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m302:[0m SessionManager started
[2m2025-06-09T03:32:33.591286Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m202:[0m ✅ SIP Test Server ready and listening on port 5062
[2m2025-06-09T03:32:33.591294Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m203:[0m 📋 Response mode: AutoAnswer
[2m2025-06-09T03:32:33.591302Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m204:[0m 🔄 Waiting for incoming calls from SIPp...
[2m2025-06-09T03:32:33.591309Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m205:[0m 📡 Real SIP server now active - SIPp can connect!
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-1-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag001\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 1-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6000 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 31, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 31, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 31, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 30, 30, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:37.799794Z[0m [32m INFO[0m ThreadId(03) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-1-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Transaction loop starting for Key(z9hG4bK-31904-1-0:INVITE:server)
Initial state: Proceeding
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-1-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:37.800243Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995 from INVITE request
🔍 INVITE HANDLER: Created early dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-1-0:INVITE:server) with dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
[2m2025-06-09T03:32:37.800344Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(58e2c7a4-f8f4-4c0d-a228-561d216a2995), transaction_id: z9hG4bK-31904-1-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-1-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag001")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("1-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6000 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:37.800532Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:37.800655Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:37.800670Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_e02f4eab-e448-43c5-b989-7d09f272cde9
[2m2025-06-09T03:32:37.800688Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:37.800699Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:37.800832Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:37.800925Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call 58e2c7a4-f8f4-4c0d-a228-561d216a2995
[2m2025-06-09T03:32:37.801129Z[0m [32m INFO[0m ThreadId(17) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:37.801228Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995 local tag set to match response: tag-d87c9884e2254790996e580513fa6f4b
[2m2025-06-09T03:32:37.801241Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995 transitioned to Confirmed state
[2m2025-06-09T03:32:37.801275Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
[2m2025-06-09T03:32:37.801298Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call 58e2c7a4-f8f4-4c0d-a228-561d216a2995
[2m2025-06-09T03:32:37.801325Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_e02f4eab-e448-43c5-b989-7d09f272cde9
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(58e2c7a4-f8f4-4c0d-a228-561d216a2995), session_answer: "v=0\r\no=rvoip 1749439957 1749439957 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:37.801365Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_e02f4eab-e448-43c5-b989-7d09f272cde9: 58e2c7a4-f8f4-4c0d-a228-561d216a2995 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:37.801387Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_e02f4eab-e448-43c5-b989-7d09f272cde9 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:37.801397Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-1-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-1-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-1-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-1-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag001\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-d87c9884e2254790996e580513fa6f4b\r\nCall-ID: 1-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, [2m2025-06-09T03:32:37.801960Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_e02f4eab-e448-43c5-b989-7d09f272cde9
2d, 33, 31, 39, 30, 34, 2d, 31, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 31, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 64, 38, 37, 63, 39, 38, 38, 34, 65, 32, 32, 35, 34, 37, 39, 30, 39, 39, 36, 65, 35, 38, 30, 35, 31, 33, 66, 61, 36, 66, 34, 62, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 31, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 100, 56, 55, 99, 57, 56, 56, 52, 101, 50, 50, 53, 52, 55, 57, 48, 57, 57, 54, 101, 53, 56, 48, 53, 49, 51, 102, 97, 54, 102, 52, 98]
Successfully parsed tag: tag-d87c9884e2254790996e580513fa6f4b
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag001")})]), "uri": Object({"user": String("sipp"), "port": Number(5061.0), "raw_uri": Null, "password": Null, "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "headers": Object({}), "scheme": String("Sip")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag001")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag001")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag001")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"headers": Object({}), "port": Number(5061.0), "host": Object({"Address": String("127.0.0.1")}), "password": Null, "parameters": Array([]), "scheme": String("Sip"), "raw_uri": Null, "user": String("sipp")}), "display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag001")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag001")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag001")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag001")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([]), "uri": Object({"user": String("test"), "headers": Object({}), "port": Number(5062.0), "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "password": Null, "scheme": String("Sip"), "raw_uri": Null}), "display_name": String("Test User")})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("Test User"), "params": Array([Object({"Tag": String("tag-d87c9884e2254790996e580513fa6f4b")})]), "uri": Object({"port": Number(5062.0), "host": Object({"Address": String("127.0.0.1")}), "raw_uri": Null, "scheme": String("Sip"), "headers": Object({}), "parameters": Array([]), "password": Null, "user": String("test")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-d87c9884e2254790996e580513fa6f4b")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-d87c9884e2254790996e580513fa6f4b")})
Final value for path 'headers.To.params[0].Tag': String("tag-d87c9884e2254790996e580513fa6f4b")
[2m2025-06-09T03:32:37.805274Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-1-0:INVITE:server) in dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(58e2c7a4-f8f4-4c0d-a228-561d216a2995), transaction_id: z9hG4bK-31904-1-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:37.805343Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_e02f4eab-e448-43c5-b989-7d09f272cde9 - creating media session (UAS side)
[2m2025-06-09T03:32:37.805363Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_e02f4eab-e448-43c5-b989-7d09f272cde9: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:37.805383Z[0m [32m INFO[0m ThreadId(13) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_e02f4eab-e448-43c5-b989-7d09f272cde9
[2m2025-06-09T03:32:37.805567Z[0m [32m INFO[0m ThreadId(13) [2mcrates/rtp-core/src/transport/allocator.rs[0m[2m:[0m[2m564:[0m Created global port allocator with range 16384-32767
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-2-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag002\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 2-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6004 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 32, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 32, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 32, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 30, 34, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:38.293856Z[0m [32m INFO[0m ThreadId(17) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-2-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
Transaction loop starting for Key(z9hG4bK-31904-2-0:INVITE:server)
Initial state: Proceeding
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-2-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
[2m2025-06-09T03:32:38.293957Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73 from INVITE request
🔍 INVITE HANDLER: Created early dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-2-0:INVITE:server) with dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
[2m2025-06-09T03:32:38.293992Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(e7f6b97a-5b12-4bef-b80c-02b17ed5ff73), transaction_id: z9hG4bK-31904-2-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-2-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag002")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("2-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6004 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:38.294049Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:38.294081Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:38.294087Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39
[2m2025-06-09T03:32:38.294101Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:38.294106Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:38.294143Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:38.294159Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
[2m2025-06-09T03:32:38.294246Z[0m [32m INFO[0m ThreadId(03) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:38.294286Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73 local tag set to match response: tag-ad99c8cc152244009c059181b3048324
[2m2025-06-09T03:32:38.294293Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73 transitioned to Confirmed state
[2m2025-06-09T03:32:38.294303Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
[2m2025-06-09T03:32:38.294314Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
[2m2025-06-09T03:32:38.294323Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(e7f6b97a-5b12-4bef-b80c-02b17ed5ff73), session_answer: "v=0\r\no=rvoip 1749439958 1749439958 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:38.294342Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39: e7f6b97a-5b12-4bef-b80c-02b17ed5ff73 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:38.294352Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:38.294357Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-2-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-2-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-2-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-2-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag002\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-ad99c8cc152244009c059181b3048324\r\nCall-ID: 2-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 32, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 32, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 61, 64, 39, 39, 63, 38, 63, 63, 31, 35, 32, 32, 34, 34, 30, 30, 39, 63, 30, 35, 39, 31, 38, 31, 62, 33, 30, 34, 38, 33, 32, 34, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 32, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 97, 100, 57, 57, 99, 56, 99, 99, 49, 53, 50, 50, 52, 52, 48, 48, 57, 99, 48, 53, 57, 49, 56, 49, 98, 51, 48, 52, 56, 51, 50, 52]
Successfully parsed tag: tag-ad99c8cc152244009c059181b3048324
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag002")})]), "uri": Object({"host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip"), "password": Null, "headers": Object({}), "parameters": Array([]), "port": Number(5061.0), "raw_uri": Null, "user": String("sipp")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag002")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag002")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag002")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "uri": Object({"password": Null, "raw_uri": Null, "headers": Object({}), "user": String("sipp"), "scheme": String("Sip"), "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "port": Number(5061.0)}), "params": Array([Object({"Tag": String("31904SIPpTag002")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag002")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag002")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag002")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"password": Null, "user": String("test"), "host": Object({"Address": String("127.0.0.1")}), "port": Number(5062.0), "headers": Object({}), "parameters": Array([]), "raw_uri": Null, "scheme": String("Sip")}), "display_name": String("Test User"), "params": Array([])})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([Object({"Tag": String("tag-ad99c8cc152244009c059181b3048324")})]), "display_name": String("Test User"), "uri": Object({"scheme": String("Sip"), "password": Null, "port": Number(5062.0), "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "raw_uri": Null, "headers": Object({}), "user": String("test")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-ad99c8cc152244009c059181b3048324")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-ad99c8cc152244009c059181b3048324")})
Final value for path 'headers.To.params[0].Tag': String("tag-ad99c8cc152244009c059181b3048324")
[2m2025-06-09T03:32:38.296452Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-2-0:INVITE:server) in dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(e7f6b97a-5b12-4bef-b80c-02b17ed5ff73), transaction_id: z9hG4bK-31904-2-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:38.296498Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 - creating media session (UAS side)
[2m2025-06-09T03:32:38.307674Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:38.307787Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=80e364cb
[2m2025-06-09T03:32:38.307820Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_e02f4eab-e448-43c5-b989-7d09f272cde9 (port: 10000)
[2m2025-06-09T03:32:38.307837Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_e02f4eab-e448-43c5-b989-7d09f272cde9 for SIP session: sess_e02f4eab-e448-43c5-b989-7d09f272cde9 with real MediaSessionController
[2m2025-06-09T03:32:38.307845Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_e02f4eab-e448-43c5-b989-7d09f272cde9
[2m2025-06-09T03:32:38.307876Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_e02f4eab-e448-43c5-b989-7d09f272cde9 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:38.307886Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_e02f4eab-e448-43c5-b989-7d09f272cde9
[2m2025-06-09T03:32:38.307898Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_e02f4eab-e448-43c5-b989-7d09f272cde9 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:38.307929Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39
[2m2025-06-09T03:32:38.307954Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:38.307963Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-3-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag003\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 3-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6008 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 33, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 33, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 33, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 30, 38, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:38.793871Z[0m [32m INFO[0m ThreadId(03) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-3-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
Transaction loop starting for Key(z9hG4bK-31904-3-0:INVITE:server)
Initial state: Proceeding
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-3-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
[2m2025-06-09T03:32:38.794007Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog 69336579-3350-4ad6-85a4-5f0e73163176 from INVITE request
🔍 INVITE HANDLER: Created early dialog 69336579-3350-4ad6-85a4-5f0e73163176
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-3-0:INVITE:server) with dialog 69336579-3350-4ad6-85a4-5f0e73163176
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog 69336579-3350-4ad6-85a4-5f0e73163176
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog 69336579-3350-4ad6-85a4-5f0e73163176
[2m2025-06-09T03:32:38.794048Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog 69336579-3350-4ad6-85a4-5f0e73163176
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(69336579-3350-4ad6-85a4-5f0e73163176), transaction_id: z9hG4bK-31904-3-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-3-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag003")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("3-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6008 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:38.794102Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog 69336579-3350-4ad6-85a4-5f0e73163176: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:38.794133Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:38.794142Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490
[2m2025-06-09T03:32:38.794150Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:38.794160Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:38.794185Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:38.794199Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call 69336579-3350-4ad6-85a4-5f0e73163176
[2m2025-06-09T03:32:38.794292Z[0m [32m INFO[0m ThreadId(17) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:38.794336Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog 69336579-3350-4ad6-85a4-5f0e73163176 local tag set to match response: tag-42e5b20323834858a6b11caeb119395b
[2m2025-06-09T03:32:38.794342Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog 69336579-3350-4ad6-85a4-5f0e73163176 transitioned to Confirmed state
[2m2025-06-09T03:32:38.794352Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog 69336579-3350-4ad6-85a4-5f0e73163176
[2m2025-06-09T03:32:38.794363Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call 69336579-3350-4ad6-85a4-5f0e73163176
[2m2025-06-09T03:32:38.794371Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(69336579-3350-4ad6-85a4-5f0e73163176), session_answer: "v=0\r\no=rvoip 1749439958 1749439958 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:38.794391Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490: 69336579-3350-4ad6-85a4-5f0e73163176 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:38.794401Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:38.794405Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-3-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-3-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-3-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-3-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag003\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-42e5b20323834858a6b11caeb119395b\r\nCall-ID: 3-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 33, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 33, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 34, 32, 65, 35, 62, 32, 30, 33, 32, 33, 38, 33, 34, 38, 35, 38, 61, 36, 62, 31, 31, 63, 61, 65, 62, 31, 31, 39, 33, 39, 35, 62, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 33, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 52, 50, 101, 53, 98, 50, 48, 51, 50, 51, 56, 51, 52, 56, 53, 56, 97, 54, 98, 49, 49, 99, 97, 101, 98, 49, 49, 57, 51, 57, 53, 98]
Successfully parsed tag: tag-42e5b20323834858a6b11caeb119395b
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"password": Null, "headers": Object({}), "raw_uri": Null, "parameters": Array([]), "user": String("sipp"), "port": Number(5061.0), "host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip")}), "params": Array([Object({"Tag": String("31904SIPpTag003")})]), "display_name": String("SIPp Test")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag003")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag003")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag003")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([Object({"Tag": String("31904SIPpTag003")})]), "uri": Object({"parameters": Array([]), "user": String("sipp"), "raw_uri": Null, "host": Object({"Address": String("127.0.0.1")}), "password": Null, "port": Number(5061.0), "scheme": String("Sip"), "headers": Object({})}), "display_name": String("SIPp Test")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag003")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag003")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag003")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"user": String("test"), "headers": Object({}), "parameters": Array([]), "password": Null, "host": Object({"Address": String("127.0.0.1")}), "port": Number(5062.0), "raw_uri": Null, "scheme": String("Sip")}), "params": Array([]), "display_name": String("Test User")})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([Object({"Tag": String("tag-42e5b20323834858a6b11caeb119395b")})]), "uri": Object({"scheme": String("Sip"), "parameters": Array([]), "user": String("test"), "host": Object({"Address": String("127.0.0.1")}), "headers": Object({}), "password": Null, "raw_uri": Null, "port": Number(5062.0)}), "display_name": String("Test User")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-42e5b20323834858a6b11caeb119395b")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-42e5b20323834858a6b11caeb119395b")})
Final value for path 'headers.To.params[0].Tag': String("tag-42e5b20323834858a6b11caeb119395b")
[2m2025-06-09T03:32:38.796302Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-3-0:INVITE:server) in dialog 69336579-3350-4ad6-85a4-5f0e73163176 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(69336579-3350-4ad6-85a4-5f0e73163176), transaction_id: z9hG4bK-31904-3-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:38.796346Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 - creating media session (UAS side)
[2m2025-06-09T03:32:38.809298Z[0m [32m INFO[0m ThreadId(17) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:38.809401Z[0m [32m INFO[0m ThreadId(17) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=679bd30c
[2m2025-06-09T03:32:38.809430Z[0m [32m INFO[0m ThreadId(17) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 (port: 10002)
[2m2025-06-09T03:32:38.809448Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 for SIP session: sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 with real MediaSessionController
[2m2025-06-09T03:32:38.809457Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39
[2m2025-06-09T03:32:38.809489Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:38.809499Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39
[2m2025-06-09T03:32:38.809519Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:38.809556Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490
[2m2025-06-09T03:32:38.809570Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:38.809581Z[0m [32m INFO[0m ThreadId(17) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-4-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag004\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 4-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6012 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 34, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 34, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 34, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 31, 32, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:39.294443Z[0m [32m INFO[0m ThreadId(17) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-4-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
Transaction loop starting for Key(z9hG4bK-31904-4-0:INVITE:server)
Initial state: Proceeding
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-4-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:39.294638Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog 0624cba2-c8f8-4525-89d0-930cc77904b8 from INVITE request
🔍 INVITE HANDLER: Created early dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-4-0:INVITE:server) with dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
[2m2025-06-09T03:32:39.294694Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(0624cba2-c8f8-4525-89d0-930cc77904b8), transaction_id: z9hG4bK-31904-4-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-4-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag004")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("4-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6012 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:39.294783Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog 0624cba2-c8f8-4525-89d0-930cc77904b8: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:39.294840Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:39.294850Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_645eb6e8-af6b-4e88-9936-b2bb6c039160
[2m2025-06-09T03:32:39.294861Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:39.294867Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:39.294925Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:39.294950Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call 0624cba2-c8f8-4525-89d0-930cc77904b8
[2m2025-06-09T03:32:39.295131Z[0m [32m INFO[0m ThreadId(15) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:39.295214Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog 0624cba2-c8f8-4525-89d0-930cc77904b8 local tag set to match response: tag-78096dcae5c04b239840f0e14ff09d13
[2m2025-06-09T03:32:39.295222Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog 0624cba2-c8f8-4525-89d0-930cc77904b8 transitioned to Confirmed state
[2m2025-06-09T03:32:39.295239Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
[2m2025-06-09T03:32:39.295255Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call 0624cba2-c8f8-4525-89d0-930cc77904b8
[2m2025-06-09T03:32:39.295266Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(0624cba2-c8f8-4525-89d0-930cc77904b8), session_answer: "v=0\r\no=rvoip 1749439959 1749439959 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:39.295295Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160: 0624cba2-c8f8-4525-89d0-930cc77904b8 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:39.295312Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:39.295318Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-4-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-4-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-4-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-4-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag004\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-78096dcae5c04b239840f0e14ff09d13\r\nCall-ID: 4-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 34, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 34, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 37, 38, 30, 39, 36, 64, 63, 61, 65, 35, 63, 30, 34, 62, 32, 33, 39, 38, 34, 30, 66, 30, 65, 31, 34, 66, 66, 30, 39, 64, 31, 33, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 34, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 55, 56, 48, 57, 54, 100, 99, 97, 101, 53, 99, 48, 52, 98, 50, 51, 57, 56, 52, 48, 102, 48, 101, 49, 52, 102, 102, 48, 57, 100, 49, 51]
Successfully parsed tag: tag-78096dcae5c04b239840f0e14ff09d13
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag004")})]), "uri": Object({"scheme": String("Sip"), "password": Null, "port": Number(5061.0), "user": String("sipp"), "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "headers": Object({}), "raw_uri": Null})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag004")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag004")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag004")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag004")})]), "uri": Object({"parameters": Array([]), "raw_uri": Null, "password": Null, "host": Object({"Address": String("127.0.0.1")}), "user": String("sipp"), "port": Number(5061.0), "headers": Object({}), "scheme": String("Sip")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag004")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag004")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag004")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"port": Number(5062.0), "password": Null, "host": Object({"Address": String("127.0.0.1")}), "headers": Object({}), "raw_uri": Null, "scheme": String("Sip"), "parameters": Array([]), "user": String("test")}), "display_name": String("Test User"), "params": Array([])})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"raw_uri": Null, "headers": Object({}), "parameters": Array([]), "host": Object({"Address": String("127.0.0.1")}), "password": Null, "port": Number(5062.0), "scheme": String("Sip"), "user": String("test")}), "display_name": String("Test User"), "params": Array([Object({"Tag": String("tag-78096dcae5c04b239840f0e14ff09d13")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-78096dcae5c04b239840f0e14ff09d13")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-78096dcae5c04b239840f0e14ff09d13")})
Final value for path 'headers.To.params[0].Tag': String("tag-78096dcae5c04b239840f0e14ff09d13")
[2m2025-06-09T03:32:39.297944Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-4-0:INVITE:server) in dialog 0624cba2-c8f8-4525-89d0-930cc77904b8 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(0624cba2-c8f8-4525-89d0-930cc77904b8), transaction_id: z9hG4bK-31904-4-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:39.298018Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 - creating media session (UAS side)
[2m2025-06-09T03:32:39.310616Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:39.310695Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=70273f38
[2m2025-06-09T03:32:39.310751Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 (port: 10004)
[2m2025-06-09T03:32:39.310777Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 for SIP session: sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 with real MediaSessionController
[2m2025-06-09T03:32:39.310788Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490
[2m2025-06-09T03:32:39.310828Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:39.310841Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490
[2m2025-06-09T03:32:39.310857Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:39.310898Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160
[2m2025-06-09T03:32:39.310911Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_645eb6e8-af6b-4e88-9936-b2bb6c039160: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:39.310921Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_645eb6e8-af6b-4e88-9936-b2bb6c039160
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-5-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag005\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 5-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6016 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 35, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 35, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 35, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 31, 36, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:39.795459Z[0m [32m INFO[0m ThreadId(03) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-5-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Transaction loop starting for Key(z9hG4bK-31904-5-0:INVITE:server)
Initial state: Proceeding
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-5-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:39.795642Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog 26061721-e395-4a89-84fc-7fc6c9fa118a from INVITE request
🔍 INVITE HANDLER: Created early dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-5-0:INVITE:server) with dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
[2m2025-06-09T03:32:39.795705Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(26061721-e395-4a89-84fc-7fc6c9fa118a), transaction_id: z9hG4bK-31904-5-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-5-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag005")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("5-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6016 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:39.795814Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog 26061721-e395-4a89-84fc-7fc6c9fa118a: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:39.795897Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:39.795909Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c
[2m2025-06-09T03:32:39.795921Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:39.795929Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:39.795987Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:39.796021Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call 26061721-e395-4a89-84fc-7fc6c9fa118a
[2m2025-06-09T03:32:39.796171Z[0m [32m INFO[0m ThreadId(12) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:39.796245Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog 26061721-e395-4a89-84fc-7fc6c9fa118a local tag set to match response: tag-1d8199297beb43929180334411d29c7e
[2m2025-06-09T03:32:39.796254Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog 26061721-e395-4a89-84fc-7fc6c9fa118a transitioned to Confirmed state
[2m2025-06-09T03:32:39.796275Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
[2m2025-06-09T03:32:39.796288Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call 26061721-e395-4a89-84fc-7fc6c9fa118a
[2m2025-06-09T03:32:39.796299Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(26061721-e395-4a89-84fc-7fc6c9fa118a), session_answer: "v=0\r\no=rvoip 1749439959 1749439959 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:39.796328Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c: 26061721-e395-4a89-84fc-7fc6c9fa118a (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:39.796345Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c - keeping in Initiating state until media ready
[2m2025-06-09T03:32:39.796352Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-5-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-5-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-5-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-5-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag005\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-1d8199297beb43929180334411d29c7e\r\nCall-ID: 5-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 35, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 35, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 31, 64, 38, 31, 39, 39, 32, 39, 37, 62, 65, 62, 34, 33, 39, 32, 39, 31, 38, 30, 33, 33, 34, 34, 31, 31, 64, 32, 39, 63, 37, 65, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 35, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 49, 100, 56, 49, 57, 57, 50, 57, 55, 98, 101, 98, 52, 51, 57, 50, 57, 49, 56, 48, 51, 51, 52, 52, 49, 49, 100, 50, 57, 99, 55, 101]
Successfully parsed tag: tag-1d8199297beb43929180334411d29c7e
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"headers": Object({}), "password": Null, "port": Number(5061.0), "scheme": String("Sip"), "raw_uri": Null, "user": String("sipp"), "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([])}), "display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag005")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag005")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag005")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag005")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "port": Number(5061.0), "raw_uri": Null, "headers": Object({}), "user": String("sipp"), "password": Null, "scheme": String("Sip")}), "display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag005")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag005")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag005")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag005")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([]), "uri": Object({"port": Number(5062.0), "headers": Object({}), "password": Null, "raw_uri": Null, "scheme": String("Sip"), "host": Object({"Address": String("127.0.0.1")}), "user": String("test"), "parameters": Array([])}), "display_name": String("Test User")})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("Test User"), "params": Array([Object({"Tag": String("tag-1d8199297beb43929180334411d29c7e")})]), "uri": Object({"password": Null, "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "raw_uri": Null, "headers": Object({}), "user": String("test"), "scheme": String("Sip"), "port": Number(5062.0)})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-1d8199297beb43929180334411d29c7e")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-1d8199297beb43929180334411d29c7e")})
Final value for path 'headers.To.params[0].Tag': String("tag-1d8199297beb43929180334411d29c7e")
[2m2025-06-09T03:32:39.799199Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-5-0:INVITE:server) in dialog 26061721-e395-4a89-84fc-7fc6c9fa118a - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(26061721-e395-4a89-84fc-7fc6c9fa118a), transaction_id: z9hG4bK-31904-5-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:39.799241Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c - creating media session (UAS side)
[2m2025-06-09T03:32:39.812948Z[0m [32m INFO[0m ThreadId(12) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:39.813082Z[0m [32m INFO[0m ThreadId(12) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=38e97489
[2m2025-06-09T03:32:39.813138Z[0m [32m INFO[0m ThreadId(12) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 (port: 10006)
[2m2025-06-09T03:32:39.813164Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 for SIP session: sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 with real MediaSessionController
[2m2025-06-09T03:32:39.813176Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_645eb6e8-af6b-4e88-9936-b2bb6c039160
[2m2025-06-09T03:32:39.813218Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:39.813230Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_645eb6e8-af6b-4e88-9936-b2bb6c039160
[2m2025-06-09T03:32:39.813248Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:39.813301Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c
[2m2025-06-09T03:32:39.813318Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:39.813331Z[0m [32m INFO[0m ThreadId(12) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-6-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag006\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 6-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6020 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 36, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 36, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 36, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 32, 30, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:40.294097Z[0m [32m INFO[0m ThreadId(12) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-6-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
Transaction loop starting for Key(z9hG4bK-31904-6-0:INVITE:server)
Initial state: Proceeding
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-6-0:INVITE:server)
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:40.294222Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog b20ba681-e9e9-4055-94be-6114795f3982 from INVITE request
🔍 INVITE HANDLER: Created early dialog b20ba681-e9e9-4055-94be-6114795f3982
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-6-0:INVITE:server) with dialog b20ba681-e9e9-4055-94be-6114795f3982
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog b20ba681-e9e9-4055-94be-6114795f3982
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog b20ba681-e9e9-4055-94be-6114795f3982
[2m2025-06-09T03:32:40.294264Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog b20ba681-e9e9-4055-94be-6114795f3982
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(b20ba681-e9e9-4055-94be-6114795f3982), transaction_id: z9hG4bK-31904-6-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-6-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag006")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("6-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6020 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:40.294327Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog b20ba681-e9e9-4055-94be-6114795f3982: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:40.294361Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:40.294369Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_a1d368a3-944d-4180-9ca6-4ac8bca37811
[2m2025-06-09T03:32:40.294377Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:40.294383Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:40.294410Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:40.294425Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call b20ba681-e9e9-4055-94be-6114795f3982
[2m2025-06-09T03:32:40.294522Z[0m [32m INFO[0m ThreadId(13) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:40.294567Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog b20ba681-e9e9-4055-94be-6114795f3982 local tag set to match response: tag-f99a9ab526e04f28866318230f766862
[2m2025-06-09T03:32:40.294574Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog b20ba681-e9e9-4055-94be-6114795f3982 transitioned to Confirmed state
[2m2025-06-09T03:32:40.294585Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog b20ba681-e9e9-4055-94be-6114795f3982
[2m2025-06-09T03:32:40.294596Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call b20ba681-e9e9-4055-94be-6114795f3982
[2m2025-06-09T03:32:40.294605Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(b20ba681-e9e9-4055-94be-6114795f3982), session_answer: "v=0\r\no=rvoip 1749439960 1749439960 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:40.294624Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811: b20ba681-e9e9-4055-94be-6114795f3982 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:40.294634Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:40.294639Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-6-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-6-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-6-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-6-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag006\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-f99a9ab526e04f28866318230f766862\r\nCall-ID: 6-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 36, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 36, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 66, 39, 39, 61, 39, 61, 62, 35, 32, 36, 65, 30, 34, 66, 32, 38, 38, 36, 36, 33, 31, 38, 32, 33, 30, 66, 37, 36, 36, 38, 36, 32, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 36, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 102, 57, 57, 97, 57, 97, 98, 53, 50, 54, 101, 48, 52, 102, 50, 56, 56, 54, 54, 51, 49, 56, 50, 51, 48, 102, 55, 54, 54, 56, 54, 50]
Successfully parsed tag: tag-f99a9ab526e04f28866318230f766862
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "uri": Object({"password": Null, "port": Number(5061.0), "headers": Object({}), "host": Object({"Address": String("127.0.0.1")}), "raw_uri": Null, "user": String("sipp"), "scheme": String("Sip"), "parameters": Array([])}), "params": Array([Object({"Tag": String("31904SIPpTag006")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag006")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag006")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag006")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "uri": Object({"raw_uri": Null, "headers": Object({}), "user": String("sipp"), "host": Object({"Address": String("127.0.0.1")}), "port": Number(5061.0), "parameters": Array([]), "scheme": String("Sip"), "password": Null}), "params": Array([Object({"Tag": String("31904SIPpTag006")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag006")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag006")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag006")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("Test User"), "params": Array([]), "uri": Object({"password": Null, "headers": Object({}), "raw_uri": Null, "parameters": Array([]), "scheme": String("Sip"), "user": String("test"), "port": Number(5062.0), "host": Object({"Address": String("127.0.0.1")})})})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"headers": Object({}), "host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip"), "user": String("test"), "raw_uri": Null, "password": Null, "parameters": Array([]), "port": Number(5062.0)}), "params": Array([Object({"Tag": String("tag-f99a9ab526e04f28866318230f766862")})]), "display_name": String("Test User")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-f99a9ab526e04f28866318230f766862")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-f99a9ab526e04f28866318230f766862")})
Final value for path 'headers.To.params[0].Tag': String("tag-f99a9ab526e04f28866318230f766862")
[2m2025-06-09T03:32:40.296622Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-6-0:INVITE:server) in dialog b20ba681-e9e9-4055-94be-6114795f3982 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(b20ba681-e9e9-4055-94be-6114795f3982), transaction_id: z9hG4bK-31904-6-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:40.296662Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 - creating media session (UAS side)
[2m2025-06-09T03:32:40.314641Z[0m [32m INFO[0m ThreadId(17) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:40.314708Z[0m [32m INFO[0m ThreadId(17) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=88955393
[2m2025-06-09T03:32:40.314738Z[0m [32m INFO[0m ThreadId(17) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c (port: 10008)
[2m2025-06-09T03:32:40.314759Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c for SIP session: sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c with real MediaSessionController
[2m2025-06-09T03:32:40.314769Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c
[2m2025-06-09T03:32:40.314800Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:40.314809Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c
[2m2025-06-09T03:32:40.314821Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:40.314855Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811
[2m2025-06-09T03:32:40.314869Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_a1d368a3-944d-4180-9ca6-4ac8bca37811: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:40.314878Z[0m [32m INFO[0m ThreadId(17) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_a1d368a3-944d-4180-9ca6-4ac8bca37811
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-7-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag007\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 7-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6024 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 37, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 37, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 37, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 32, 34, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:40.794033Z[0m [32m INFO[0m ThreadId(15) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-7-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
Transaction loop starting for Key(z9hG4bK-31904-7-0:INVITE:server)
Initial state: Proceeding
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-7-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:40.794153Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb from INVITE request
🔍 INVITE HANDLER: Created early dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-7-0:INVITE:server) with dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
[2m2025-06-09T03:32:40.794194Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(fc3d557c-549e-4c84-a82d-9a9e19b4c5cb), transaction_id: z9hG4bK-31904-7-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-7-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag007")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("7-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6024 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:40.794265Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:40.794294Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:40.794301Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98
[2m2025-06-09T03:32:40.794308Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:40.794313Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:40.794336Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:40.794350Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
[2m2025-06-09T03:32:40.794443Z[0m [32m INFO[0m ThreadId(17) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:40.794497Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb local tag set to match response: tag-f77826359ee342b6b14c8e459d971135
[2m2025-06-09T03:32:40.794503Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb transitioned to Confirmed state
[2m2025-06-09T03:32:40.794514Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
[2m2025-06-09T03:32:40.794525Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
[2m2025-06-09T03:32:40.794533Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(fc3d557c-549e-4c84-a82d-9a9e19b4c5cb), session_answer: "v=0\r\no=rvoip 1749439960 1749439960 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:40.794551Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98: fc3d557c-549e-4c84-a82d-9a9e19b4c5cb (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:40.794562Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:40.794566Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-7-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-7-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-7-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-7-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag007\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-f77826359ee342b6b14c8e459d971135\r\nCall-ID: 7-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 37, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 37, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 66, 37, 37, 38, 32, 36, 33, 35, 39, 65, 65, 33, 34, 32, 62, 36, 62, 31, 34, 63, 38, 65, 34, 35, 39, 64, 39, 37, 31, 31, 33, 35, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 37, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 102, 55, 55, 56, 50, 54, 51, 53, 57, 101, 101, 51, 52, 50, 98, 54, 98, 49, 52, 99, 56, 101, 52, 53, 57, 100, 57, 55, 49, 49, 51, 53]
Successfully parsed tag: tag-f77826359ee342b6b14c8e459d971135
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([Object({"Tag": String("31904SIPpTag007")})]), "uri": Object({"host": Object({"Address": String("127.0.0.1")}), "port": Number(5061.0), "scheme": String("Sip"), "parameters": Array([]), "user": String("sipp"), "headers": Object({}), "raw_uri": Null, "password": Null}), "display_name": String("SIPp Test")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag007")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag007")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag007")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"host": Object({"Address": String("127.0.0.1")}), "password": Null, "headers": Object({}), "port": Number(5061.0), "raw_uri": Null, "parameters": Array([]), "scheme": String("Sip"), "user": String("sipp")}), "display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag007")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag007")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag007")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag007")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("Test User"), "params": Array([]), "uri": Object({"port": Number(5062.0), "scheme": String("Sip"), "raw_uri": Null, "parameters": Array([]), "password": Null, "host": Object({"Address": String("127.0.0.1")}), "headers": Object({}), "user": String("test")})})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"parameters": Array([]), "host": Object({"Address": String("127.0.0.1")}), "headers": Object({}), "raw_uri": Null, "scheme": String("Sip"), "password": Null, "port": Number(5062.0), "user": String("test")}), "display_name": String("Test User"), "params": Array([Object({"Tag": String("tag-f77826359ee342b6b14c8e459d971135")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-f77826359ee342b6b14c8e459d971135")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-f77826359ee342b6b14c8e459d971135")})
Final value for path 'headers.To.params[0].Tag': String("tag-f77826359ee342b6b14c8e459d971135")
[2m2025-06-09T03:32:40.796507Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-7-0:INVITE:server) in dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(fc3d557c-549e-4c84-a82d-9a9e19b4c5cb), transaction_id: z9hG4bK-31904-7-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:40.796553Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 - creating media session (UAS side)
[2m2025-06-09T03:32:40.816614Z[0m [32m INFO[0m ThreadId(15) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:40.816722Z[0m [32m INFO[0m ThreadId(15) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=d1ead52f
[2m2025-06-09T03:32:40.816758Z[0m [32m INFO[0m ThreadId(15) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 (port: 10010)
[2m2025-06-09T03:32:40.816781Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 for SIP session: sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 with real MediaSessionController
[2m2025-06-09T03:32:40.816792Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_a1d368a3-944d-4180-9ca6-4ac8bca37811
[2m2025-06-09T03:32:40.816824Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:40.816836Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_a1d368a3-944d-4180-9ca6-4ac8bca37811
[2m2025-06-09T03:32:40.816852Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:40.816884Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98
[2m2025-06-09T03:32:40.816898Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:40.816908Z[0m [32m INFO[0m ThreadId(15) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-8-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag008\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 8-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6028 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 38, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 38, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 38, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 32, 38, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:41.294351Z[0m [32m INFO[0m ThreadId(13) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-8-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
Transaction loop starting for Key(z9hG4bK-31904-8-0:INVITE:server)
Initial state: Proceeding
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-8-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:41.294515Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog ac04ede6-8a68-4595-af76-980ead4241c5 from INVITE request
🔍 INVITE HANDLER: Created early dialog ac04ede6-8a68-4595-af76-980ead4241c5
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-8-0:INVITE:server) with dialog ac04ede6-8a68-4595-af76-980ead4241c5
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog ac04ede6-8a68-4595-af76-980ead4241c5
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog ac04ede6-8a68-4595-af76-980ead4241c5
[2m2025-06-09T03:32:41.294565Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog ac04ede6-8a68-4595-af76-980ead4241c5
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(ac04ede6-8a68-4595-af76-980ead4241c5), transaction_id: z9hG4bK-31904-8-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-8-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag008")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("8-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6028 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:41.294636Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog ac04ede6-8a68-4595-af76-980ead4241c5: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:41.294682Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:41.294692Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_53dab83c-b560-43e6-bc6e-cb180b2d4515
[2m2025-06-09T03:32:41.294702Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:41.294710Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:41.294745Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:41.294766Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call ac04ede6-8a68-4595-af76-980ead4241c5
[2m2025-06-09T03:32:41.294888Z[0m [32m INFO[0m ThreadId(03) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:41.294942Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog ac04ede6-8a68-4595-af76-980ead4241c5 local tag set to match response: tag-1ef3a3f315a5421c87d5be9f93a93c22
[2m2025-06-09T03:32:41.294951Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog ac04ede6-8a68-4595-af76-980ead4241c5 transitioned to Confirmed state
[2m2025-06-09T03:32:41.294965Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog ac04ede6-8a68-4595-af76-980ead4241c5
[2m2025-06-09T03:32:41.294977Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call ac04ede6-8a68-4595-af76-980ead4241c5
[2m2025-06-09T03:32:41.294986Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(ac04ede6-8a68-4595-af76-980ead4241c5), session_answer: "v=0\r\no=rvoip 1749439961 1749439961 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:41.295011Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515: ac04ede6-8a68-4595-af76-980ead4241c5 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:41.295026Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:41.295032Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-8-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-8-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-8-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-8-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag008\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-1ef3a3f315a5421c87d5be9f93a93c22\r\nCall-ID: 8-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 38, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 38, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 31, 65, 66, 33, 61, 33, 66, 33, 31, 35, 61, 35, 34, 32, 31, 63, 38, 37, 64, 35, 62, 65, 39, 66, 39, 33, 61, 39, 33, 63, 32, 32, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 38, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 49, 101, 102, 51, 97, 51, 102, 51, 49, 53, 97, 53, 52, 50, 49, 99, 56, 55, 100, 53, 98, 101, 57, 102, 57, 51, 97, 57, 51, 99, 50, 50]
Successfully parsed tag: tag-1ef3a3f315a5421c87d5be9f93a93c22
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag008")})]), "uri": Object({"raw_uri": Null, "host": Object({"Address": String("127.0.0.1")}), "headers": Object({}), "port": Number(5061.0), "user": String("sipp"), "parameters": Array([]), "password": Null, "scheme": String("Sip")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag008")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag008")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag008")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag008")})]), "uri": Object({"port": Number(5061.0), "password": Null, "headers": Object({}), "host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip"), "raw_uri": Null, "parameters": Array([]), "user": String("sipp")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag008")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag008")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag008")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"headers": Object({}), "scheme": String("Sip"), "host": Object({"Address": String("127.0.0.1")}), "password": Null, "port": Number(5062.0), "raw_uri": Null, "parameters": Array([]), "user": String("test")}), "display_name": String("Test User"), "params": Array([])})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("Test User"), "params": Array([Object({"Tag": String("tag-1ef3a3f315a5421c87d5be9f93a93c22")})]), "uri": Object({"raw_uri": Null, "user": String("test"), "port": Number(5062.0), "parameters": Array([]), "password": Null, "headers": Object({}), "host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip")})})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-1ef3a3f315a5421c87d5be9f93a93c22")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-1ef3a3f315a5421c87d5be9f93a93c22")})
Final value for path 'headers.To.params[0].Tag': String("tag-1ef3a3f315a5421c87d5be9f93a93c22")
[2m2025-06-09T03:32:41.297702Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-8-0:INVITE:server) in dialog ac04ede6-8a68-4595-af76-980ead4241c5 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(ac04ede6-8a68-4595-af76-980ead4241c5), transaction_id: z9hG4bK-31904-8-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:41.297741Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 - creating media session (UAS side)
[2m2025-06-09T03:32:41.318762Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:41.318830Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=8957d0c7
[2m2025-06-09T03:32:41.318859Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 (port: 10012)
[2m2025-06-09T03:32:41.318879Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 for SIP session: sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 with real MediaSessionController
[2m2025-06-09T03:32:41.318890Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98
[2m2025-06-09T03:32:41.318925Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:41.318936Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98
[2m2025-06-09T03:32:41.318953Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:41.318993Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515
[2m2025-06-09T03:32:41.319008Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_53dab83c-b560-43e6-bc6e-cb180b2d4515: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:41.319022Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_53dab83c-b560-43e6-bc6e-cb180b2d4515
=== PARSING SIP MESSAGE ===
Input length: 590 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-9-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag009\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 9-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6032 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 39, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 39, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 39, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 33, 32, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:41.794641Z[0m [32m INFO[0m ThreadId(17) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-9-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
Transaction loop starting for Key(z9hG4bK-31904-9-0:INVITE:server)
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Initial state: Proceeding
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-9-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:41.794742Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog 420789c3-e5e5-4430-854b-694044ffb2a8 from INVITE request
🔍 INVITE HANDLER: Created early dialog 420789c3-e5e5-4430-854b-694044ffb2a8
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-9-0:INVITE:server) with dialog 420789c3-e5e5-4430-854b-694044ffb2a8
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog 420789c3-e5e5-4430-854b-694044ffb2a8
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog 420789c3-e5e5-4430-854b-694044ffb2a8
[2m2025-06-09T03:32:41.794781Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog 420789c3-e5e5-4430-854b-694044ffb2a8
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(420789c3-e5e5-4430-854b-694044ffb2a8), transaction_id: z9hG4bK-31904-9-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-9-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag009")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("9-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6032 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:41.794866Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog 420789c3-e5e5-4430-854b-694044ffb2a8: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:41.794904Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:41.794913Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_bd8a6b74-7dbc-4707-aa53-837c314df3de
[2m2025-06-09T03:32:41.794923Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:41.794930Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:41.794957Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:41.794974Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call 420789c3-e5e5-4430-854b-694044ffb2a8
[2m2025-06-09T03:32:41.795063Z[0m [32m INFO[0m ThreadId(13) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:41.795115Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog 420789c3-e5e5-4430-854b-694044ffb2a8 local tag set to match response: tag-c4af7ef72ce5402db8a9ff3f093f1776
[2m2025-06-09T03:32:41.795123Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog 420789c3-e5e5-4430-854b-694044ffb2a8 transitioned to Confirmed state
[2m2025-06-09T03:32:41.795136Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog 420789c3-e5e5-4430-854b-694044ffb2a8
[2m2025-06-09T03:32:41.795148Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call 420789c3-e5e5-4430-854b-694044ffb2a8
[2m2025-06-09T03:32:41.795156Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(420789c3-e5e5-4430-854b-694044ffb2a8), session_answer: "v=0\r\no=rvoip 1749439961 1749439961 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:41.795177Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de: 420789c3-e5e5-4430-854b-694044ffb2a8 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:41.795187Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de - keeping in Initiating state until media ready
[2m2025-06-09T03:32:41.795194Z[0m [32m INFO[0m ThreadId(13) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-9-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-9-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-9-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-9-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag009\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-c4af7ef72ce5402db8a9ff3f093f1776\r\nCall-ID: 9-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 39, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 39, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 63, 34, 61, 66, 37, 65, 66, 37, 32, 63, 65, 35, 34, 30, 32, 64, 62, 38, 61, 39, 66, 66, 33, 66, 30, 39, 33, 66, 31, 37, 37, 36, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 39, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 99, 52, 97, 102, 55, 101, 102, 55, 50, 99, 101, 53, 52, 48, 50, 100, 98, 56, 97, 57, 102, 102, 51, 102, 48, 57, 51, 102, 49, 55, 55, 54]
Successfully parsed tag: tag-c4af7ef72ce5402db8a9ff3f093f1776
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([Object({"Tag": String("31904SIPpTag009")})]), "uri": Object({"scheme": String("Sip"), "raw_uri": Null, "parameters": Array([]), "headers": Object({}), "password": Null, "user": String("sipp"), "port": Number(5061.0), "host": Object({"Address": String("127.0.0.1")})}), "display_name": String("SIPp Test")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag009")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag009")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag009")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"port": Number(5061.0), "parameters": Array([]), "password": Null, "scheme": String("Sip"), "host": Object({"Address": String("127.0.0.1")}), "raw_uri": Null, "user": String("sipp"), "headers": Object({})}), "display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag009")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag009")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag009")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag009")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([]), "uri": Object({"scheme": String("Sip"), "raw_uri": Null, "headers": Object({}), "host": Object({"Address": String("127.0.0.1")}), "user": String("test"), "parameters": Array([]), "port": Number(5062.0), "password": Null}), "display_name": String("Test User")})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"display_name": String("Test User"), "uri": Object({"password": Null, "port": Number(5062.0), "scheme": String("Sip"), "user": String("test"), "parameters": Array([]), "raw_uri": Null, "headers": Object({}), "host": Object({"Address": String("127.0.0.1")})}), "params": Array([Object({"Tag": String("tag-c4af7ef72ce5402db8a9ff3f093f1776")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-c4af7ef72ce5402db8a9ff3f093f1776")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-c4af7ef72ce5402db8a9ff3f093f1776")})
Final value for path 'headers.To.params[0].Tag': String("tag-c4af7ef72ce5402db8a9ff3f093f1776")
[2m2025-06-09T03:32:41.797381Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-9-0:INVITE:server) in dialog 420789c3-e5e5-4430-854b-694044ffb2a8 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(420789c3-e5e5-4430-854b-694044ffb2a8), transaction_id: z9hG4bK-31904-9-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:41.797417Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de - creating media session (UAS side)
[2m2025-06-09T03:32:41.820233Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:41.820308Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=2131cf25
[2m2025-06-09T03:32:41.820358Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 (port: 10014)
[2m2025-06-09T03:32:41.820378Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 for SIP session: sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 with real MediaSessionController
[2m2025-06-09T03:32:41.820385Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_53dab83c-b560-43e6-bc6e-cb180b2d4515
[2m2025-06-09T03:32:41.820421Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:41.820432Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_53dab83c-b560-43e6-bc6e-cb180b2d4515
[2m2025-06-09T03:32:41.820445Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515 transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:41.820493Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de
[2m2025-06-09T03:32:41.820510Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_bd8a6b74-7dbc-4707-aa53-837c314df3de: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:41.820520Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_bd8a6b74-7dbc-4707-aa53-837c314df3de
=== PARSING SIP MESSAGE ===
Input length: 593 bytes
Input as string: "INVITE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-10-0\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag0010\r\nTo: Test User <sip:test@127.0.0.1:5062>\r\nCall-ID: 10-31904@127.0.0.1\r\nCSeq: 1 INVITE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Type: application/sdp\r\nContent-Length:   181\r\n\r\nv=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6036 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n"
Input as hex: [49, 4e, 56, 49, 54, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 31, 30, 2d, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 31, 30, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 31, 30, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 49, 4e, 56, 49, 54, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 54, 79, 70, 65, 3a, 20, 61, 70, 70, 6c, 69, 63, 61, 74, 69, 6f, 6e, 2f, 73, 64, 70, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 20, 20, 31, 38, 31, 0d, 0a, 0d, 0a, 76, 3d, 30, 0d, 0a, 6f, 3d, 75, 73, 65, 72, 31, 20, 35, 33, 36, 35, 35, 37, 36, 35, 20, 32, 33, 35, 33, 36, 38, 37, 36, 33, 37, 20, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 73, 3d, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 53, 65, 73, 73, 69, 6f, 6e, 0d, 0a, 63, 3d, 49, 4e, 20, 49, 50, 34, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 74, 3d, 30, 20, 30, 0d, 0a, 6d, 3d, 61, 75, 64, 69, 6f, 20, 36, 30, 33, 36, 20, 52, 54, 50, 2f, 41, 56, 50, 20, 30, 20, 38, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 30, 20, 50, 43, 4d, 55, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 72, 74, 70, 6d, 61, 70, 3a, 38, 20, 50, 43, 4d, 41, 2f, 38, 30, 30, 30, 0d, 0a, 61, 3d, 73, 65, 6e, 64, 72, 65, 63, 76, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:42.296384Z[0m [32m INFO[0m ThreadId(13) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m1958:[0m Created new ServerInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-10-0:INVITE:server) [3mmethod[0m[2m=[0mINVITE
Transaction loop starting for Key(z9hG4bK-31904-10-0:INVITE:server)
Initial state: Proceeding
🎯 FOUND UNASSOCIATED INVITE: Processing new incoming INVITE from 127.0.0.1:5061
🔍 INVITE HANDLER: Processing initial INVITE request from 127.0.0.1:5061
Received command: TransitionTo(Proceeding) for transaction Key(z9hG4bK-31904-10-0:INVITE:server)
Processing TransitionTo(Proceeding) current state: Proceeding
Already in requested state, no transition needed: Proceeding
[2m2025-06-09T03:32:42.296515Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/manager/dialog_operations.rs[0m[2m:[0m[2m435:[0m Created early dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1 from INVITE request
🔍 INVITE HANDLER: Created early dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
🔍 INVITE HANDLER: Associated transaction Key(z9hG4bK-31904-10-0:INVITE:server) with dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
🔍 INVITE HANDLER: About to send SessionCoordinationEvent::IncomingCall for dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
🔍 INVITE HANDLER: Successfully sent SessionCoordinationEvent::IncomingCall for dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
[2m2025-06-09T03:32:42.296564Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/protocol/invite_handler.rs[0m[2m:[0m[2m101:[0m Initial INVITE processed, created dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: IncomingCall { dialog_id: DialogId(5b5c90b4-8420-44da-adb1-f2534b1271b1), transaction_id: z9hG4bK-31904-10-0:INVITE:server, request: Request { method: Invite, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-10-0")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag0010")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("10-31904@127.0.0.1")), CSeq(CSeq { seq: 1, method: Invite }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentType(ContentType(ContentTypeValue { m_type: "application", m_subtype: "sdp", parameters: {} })), ContentLength(ContentLength(181))], body: b"v=0\r\no=user1 53655765 2353687637 IN IP4 127.0.0.1\r\ns=SIPp Test Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 6036 RTP/AVP 0 8\r\na=rtpmap:0 PCMU/8000\r\na=rtpmap:8 PCMA/8000\r\na=sendrecv\r\n" }, source: 127.0.0.1:5061 }
[2m2025-06-09T03:32:42.296637Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m143:[0m Incoming call from dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1: sip:from@127.0.0.1 -> sip:to@local
[2m2025-06-09T03:32:42.296680Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m77:[0m 📞 [SIPp-Test-Server] Incoming call from sip:from@127.0.0.1 to sip:to@local
[2m2025-06-09T03:32:42.296691Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m78:[0m 📞 [SIPp-Test-Server] Call ID: sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08
[2m2025-06-09T03:32:42.296701Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m89:[0m ✅ [SIPp-Test-Server] Auto-answering call
[2m2025-06-09T03:32:42.296709Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m93:[0m 📞 [SIPp-Test-Server] Received SDP offer, generating answer
[2m2025-06-09T03:32:42.296746Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m96:[0m 📞 [SIPp-Test-Server] Generated SDP answer
[2m2025-06-09T03:32:42.296767Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m537:[0m Answering call 5b5c90b4-8420-44da-adb1-f2534b1271b1
[2m2025-06-09T03:32:42.296888Z[0m [32m INFO[0m ThreadId(12) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-09T03:32:42.296934Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m628:[0m Dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1 local tag set to match response: tag-0feafe5a0d574d7b96f037808e7cd364
[2m2025-06-09T03:32:42.296944Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m640:[0m Dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1 transitioned to Confirmed state
[2m2025-06-09T03:32:42.296960Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m647:[0m Updated dialog lookup for confirmed dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
[2m2025-06-09T03:32:42.296974Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/api/common.rs[0m[2m:[0m[2m661:[0m Successfully answered call 5b5c90b4-8420-44da-adb1-f2534b1271b1
[2m2025-06-09T03:32:42.296985Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m205:[0m Successfully answered incoming call for session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallAnswered { dialog_id: DialogId(5b5c90b4-8420-44da-adb1-f2534b1271b1), session_answer: "v=0\r\no=rvoip 1749439962 1749439962 IN IP4 127.0.0.1\r\ns=RVOIP Session\r\nc=IN IP4 127.0.0.1\r\nt=0 0\r\nm=audio 10001 RTP/AVP 0\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n" }
[2m2025-06-09T03:32:42.297013Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m409:[0m Call answered for session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08: 5b5c90b4-8420-44da-adb1-f2534b1271b1 (awaiting ACK per RFC 3261)
[2m2025-06-09T03:32:42.297028Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m423:[0m 📞 Call answered for session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 - keeping in Initiating state until media ready
[2m2025-06-09T03:32:42.297049Z[0m [32m INFO[0m ThreadId(12) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m426:[0m 🚫 RFC 3261: NOT creating media session yet - waiting for ACK
Received command: CancelTimer100 for transaction Key(z9hG4bK-31904-10-0:INVITE:server)
Received command: TransitionTo(Terminated) for transaction Key(z9hG4bK-31904-10-0:INVITE:server)
Processing TransitionTo(Terminated) current state: Proceeding
Valid state transition: Proceeding -> Terminated
State successfully changed to: Terminated
Sent StateChanged event result: Success
Transaction loop ending for Key(z9hG4bK-31904-10-0:INVITE:server). Final state: Terminated
=== PARSING SIP MESSAGE ===
Input length: 412 bytes
Input as string: "ACK sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-10-4\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag0010\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-0feafe5a0d574d7b96f037808e7cd364\r\nCall-ID: 10-31904@127.0.0.1\r\nCSeq: 1 ACK\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [41, 43, 4b, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 31, 30, 2d, 34, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 31, 30, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 30, 66, 65, 61, 66, 65, 35, 61, 30, 64, 35, 37, 34, 64, 37, 62, 39, 36, 66, 30, 33, 37, 38, 30, 38, 65, 37, 63, 64, 33, 36, 34, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 31, 30, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 41, 43, 4b, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 48, 102, 101, 97, 102, 101, 53, 97, 48, 100, 53, 55, 52, 100, 55, 98, 57, 54, 102, 48, 51, 55, 56, 48, 56, 101, 55, 99, 100, 51, 54, 52]
Successfully parsed tag: tag-0feafe5a0d574d7b96f037808e7cd364
=== PARSE SUCCESS ===
Successfully parsed message
=====================
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"params": Array([Object({"Tag": String("31904SIPpTag0010")})]), "uri": Object({"headers": Object({}), "raw_uri": Null, "parameters": Array([]), "port": Number(5061.0), "host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip"), "password": Null, "user": String("sipp")}), "display_name": String("SIPp Test")})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag0010")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag0010")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag0010")
Parsed path: [Field("headers"), Field("From"), Field("params"), Index(0), Field("Tag")] from 'headers.From.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"user": String("sipp"), "host": Object({"Address": String("127.0.0.1")}), "headers": Object({}), "parameters": Array([]), "password": Null, "port": Number(5061.0), "scheme": String("Sip"), "raw_uri": Null}), "display_name": String("SIPp Test"), "params": Array([Object({"Tag": String("31904SIPpTag0010")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("31904SIPpTag0010")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("31904SIPpTag0010")})
Final value for path 'headers.From.params[0].Tag': String("31904SIPpTag0010")
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"port": Number(5062.0), "host": Object({"Address": String("127.0.0.1")}), "scheme": String("Sip"), "parameters": Array([]), "headers": Object({}), "user": String("test"), "password": Null, "raw_uri": Null}), "display_name": String("Test User"), "params": Array([])})
Processing segment Index(0) at index 3, current value: Array([])
Index 0 out of bounds for array of length 0
Parsed path: [Field("headers"), Field("To"), Field("params"), Index(0), Field("Tag")] from 'headers.To.params[0].Tag'
Processing segment Field("params") at index 2, current value: Object({"uri": Object({"raw_uri": Null, "headers": Object({}), "host": Object({"Address": String("127.0.0.1")}), "parameters": Array([]), "password": Null, "user": String("test"), "scheme": String("Sip"), "port": Number(5062.0)}), "display_name": String("Test User"), "params": Array([Object({"Tag": String("tag-0feafe5a0d574d7b96f037808e7cd364")})])})
Processing segment Index(0) at index 3, current value: Array([Object({"Tag": String("tag-0feafe5a0d574d7b96f037808e7cd364")})])
Processing segment Field("Tag") at index 4, current value: Object({"Tag": String("tag-0feafe5a0d574d7b96f037808e7cd364")})
Final value for path 'headers.To.params[0].Tag': String("tag-0feafe5a0d574d7b96f037808e7cd364")
[2m2025-06-09T03:32:42.300121Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/manager/transaction_integration.rs[0m[2m:[0m[2m758:[0m ✅ RFC 3261: ACK received for transaction Key(z9hG4bK-31904-10-0:INVITE:server) in dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1 - time to start media (UAS side)
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: AckReceived { dialog_id: DialogId(5b5c90b4-8420-44da-adb1-f2534b1271b1), transaction_id: z9hG4bK-31904-10-0:INVITE:server, negotiated_sdp: None }
[2m2025-06-09T03:32:42.300167Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m518:[0m ✅ RFC 3261: ACK RECEIVED for session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 - creating media session (UAS side)
[2m2025-06-09T03:32:42.321637Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:42.321705Z[0m [32m INFO[0m ThreadId(03) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=99a5aae1
[2m2025-06-09T03:32:42.321732Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_bd8a6b74-7dbc-4707-aa53-837c314df3de (port: 10016)
[2m2025-06-09T03:32:42.321750Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_bd8a6b74-7dbc-4707-aa53-837c314df3de for SIP session: sess_bd8a6b74-7dbc-4707-aa53-837c314df3de with real MediaSessionController
[2m2025-06-09T03:32:42.321758Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_bd8a6b74-7dbc-4707-aa53-837c314df3de
[2m2025-06-09T03:32:42.321795Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_bd8a6b74-7dbc-4707-aa53-837c314df3de with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:42.321805Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_bd8a6b74-7dbc-4707-aa53-837c314df3de
[2m2025-06-09T03:32:42.321820Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de transitioned to Active in registry - media ready and session fully established!
[2m2025-06-09T03:32:42.321858Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m159:[0m 📄 Stored remote SDP answer for session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08
[2m2025-06-09T03:32:42.321872Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m206:[0m 🚀 RFC 3261: Creating media session after ACK for sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08: rfc_compliant_media_creation_uas
[2m2025-06-09T03:32:42.321882Z[0m [32m INFO[0m ThreadId(03) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m377:[0m Starting media session for dialog: media-sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-1-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag001\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-d87c9884e2254790996e580513fa6f4b\r\nCall-ID: 1-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 31, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 31, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 64, 38, 37, 63, 39, 38, 38, 34, 65, 32, 32, 35, 34, 37, 39, 30, 39, 39, 36, 65, 35, 38, 30, 35, 31, 33, 66, 61, 36, 66, 34, 62, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 31, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 100, 56, 55, 99, 57, 56, 56, 52, 101, 50, 50, 53, 52, 55, 57, 48, 57, 57, 54, 101, 53, 56, 48, 53, 49, 51, 102, 97, 54, 102, 52, 98]
Successfully parsed tag: tag-d87c9884e2254790996e580513fa6f4b
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:42.806669Z[0m [32m INFO[0m ThreadId(03) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-1-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-1-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-1-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-1-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag001")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-d87c9884e2254790996e580513fa6f4b")] })), CallId(CallId("1-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-1-7:BYE:server)
[2m2025-06-09T03:32:42.807066Z[0m [32m INFO[0m ThreadId(03) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-1-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(58e2c7a4-f8f4-4c0d-a228-561d216a2995), reason: "BYE received" }
Sent StateChanged event result: Success
[2m2025-06-09T03:32:42.807167Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog 58e2c7a4-f8f4-4c0d-a228-561d216a2995
[2m2025-06-09T03:32:42.807260Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_e02f4eab-e448-43c5-b989-7d09f272cde9: 58e2c7a4-f8f4-4c0d-a228-561d216a2995 - BYE received
[2m2025-06-09T03:32:42.824099Z[0m [32m INFO[0m ThreadId(11) [2mcrates/rtp-core/src/transport/udp.rs[0m[2m:[0m[2m394:[0m Started UDP transport receiver tasks
[2m2025-06-09T03:32:42.824333Z[0m [32m INFO[0m ThreadId(11) [2mcrates/rtp-core/src/session/mod.rs[0m[2m:[0m[2m751:[0m Started RTP session with SSRC=ef7c777a
[2m2025-06-09T03:32:42.824381Z[0m [32m INFO[0m ThreadId(11) [2mcrates/media-core/src/relay/controller.rs[0m[2m:[0m[2m457:[0m ✅ Created media session with REAL RTP session: media-sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 (port: 10018)
[2m2025-06-09T03:32:42.824412Z[0m [32m INFO[0m ThreadId(11) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m82:[0m ✅ Created media session: media-sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 for SIP session: sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 with real MediaSessionController
[2m2025-06-09T03:32:42.824430Z[0m [32m INFO[0m ThreadId(11) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m215:[0m ✅ Successfully created RFC-compliant media session for sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08
[2m2025-06-09T03:32:42.824497Z[0m [32m INFO[0m ThreadId(11) [2mcrates/session-core/src/media/manager.rs[0m[2m:[0m[2m119:[0m ✅ Updated media session for SIP session: sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 with remote: 127.0.0.1:10001 and codecs: ["PCMU"]
[2m2025-06-09T03:32:42.824513Z[0m [32m INFO[0m ThreadId(11) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m224:[0m ✅ Applied stored remote SDP to new media session for sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08
[2m2025-06-09T03:32:42.824539Z[0m [32m INFO[0m ThreadId(11) [2mcrates/session-core/src/manager/core.rs[0m[2m:[0m[2m239:[0m 🎉 Session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08 transitioned to Active in registry - media ready and session fully established!
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-2-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag002\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-ad99c8cc152244009c059181b3048324\r\nCall-ID: 2-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 32, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 32, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 61, 64, 39, 39, 63, 38, 63, 63, 31, 35, 32, 32, 34, 34, 30, 30, 39, 63, 30, 35, 39, 31, 38, 31, 62, 33, 30, 34, 38, 33, 32, 34, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 32, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 97, 100, 57, 57, 99, 56, 99, 99, 49, 53, 50, 50, 52, 52, 48, 48, 57, 99, 48, 53, 57, 49, 56, 49, 98, 51, 48, 52, 56, 51, 50, 52]
Successfully parsed tag: tag-ad99c8cc152244009c059181b3048324
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:43.297968Z[0m [32m INFO[0m ThreadId(03) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-2-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-2-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-2-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-2-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag002")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-ad99c8cc152244009c059181b3048324")] })), CallId(CallId("2-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-2-7:BYE:server)
[2m2025-06-09T03:32:43.298115Z[0m [32m INFO[0m ThreadId(03) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-2-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
[2m2025-06-09T03:32:43.298166Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog e7f6b97a-5b12-4bef-b80c-02b17ed5ff73
Sent StateChanged event result: Success
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(e7f6b97a-5b12-4bef-b80c-02b17ed5ff73), reason: "BYE received" }
[2m2025-06-09T03:32:43.298254Z[0m [32m INFO[0m ThreadId(15) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_1e47fe85-ef0a-4501-b4be-c7a034f8be39: e7f6b97a-5b12-4bef-b80c-02b17ed5ff73 - BYE received
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-3-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag003\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-42e5b20323834858a6b11caeb119395b\r\nCall-ID: 3-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 33, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 33, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 34, 32, 65, 35, 62, 32, 30, 33, 32, 33, 38, 33, 34, 38, 35, 38, 61, 36, 62, 31, 31, 63, 61, 65, 62, 31, 31, 39, 33, 39, 35, 62, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 33, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 52, 50, 101, 53, 98, 50, 48, 51, 50, 51, 56, 51, 52, 56, 53, 56, 97, 54, 98, 49, 49, 99, 97, 101, 98, 49, 49, 57, 51, 57, 53, 98]
Successfully parsed tag: tag-42e5b20323834858a6b11caeb119395b
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:43.797326Z[0m [32m INFO[0m ThreadId(11) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-3-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-3-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-3-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-3-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag003")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-42e5b20323834858a6b11caeb119395b")] })), CallId(CallId("3-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-3-7:BYE:server)
[2m2025-06-09T03:32:43.797536Z[0m [32m INFO[0m ThreadId(11) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-3-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
Sent StateChanged event result: Success
[2m2025-06-09T03:32:43.797617Z[0m [32m INFO[0m ThreadId(11) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog 69336579-3350-4ad6-85a4-5f0e73163176
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(69336579-3350-4ad6-85a4-5f0e73163176), reason: "BYE received" }
[2m2025-06-09T03:32:43.797662Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_71aab1e7-23c7-44c2-9316-f5cbbb0a9490: 69336579-3350-4ad6-85a4-5f0e73163176 - BYE received
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-4-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag004\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-78096dcae5c04b239840f0e14ff09d13\r\nCall-ID: 4-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 34, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 34, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 37, 38, 30, 39, 36, 64, 63, 61, 65, 35, 63, 30, 34, 62, 32, 33, 39, 38, 34, 30, 66, 30, 65, 31, 34, 66, 66, 30, 39, 64, 31, 33, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 34, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 55, 56, 48, 57, 54, 100, 99, 97, 101, 53, 99, 48, 52, 98, 50, 51, 57, 56, 52, 48, 102, 48, 101, 49, 52, 102, 102, 48, 57, 100, 49, 51]
Successfully parsed tag: tag-78096dcae5c04b239840f0e14ff09d13
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:44.300520Z[0m [32m INFO[0m ThreadId(11) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-4-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-4-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-4-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-4-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag004")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-78096dcae5c04b239840f0e14ff09d13")] })), CallId(CallId("4-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-4-7:BYE:server)
[2m2025-06-09T03:32:44.300751Z[0m [32m INFO[0m ThreadId(11) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-4-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
Sent StateChanged event result: Success
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(0624cba2-c8f8-4525-89d0-930cc77904b8), reason: "BYE received" }
[2m2025-06-09T03:32:44.300835Z[0m [32m INFO[0m ThreadId(11) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog 0624cba2-c8f8-4525-89d0-930cc77904b8
[2m2025-06-09T03:32:44.300884Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_645eb6e8-af6b-4e88-9936-b2bb6c039160: 0624cba2-c8f8-4525-89d0-930cc77904b8 - BYE received
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-5-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag005\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-1d8199297beb43929180334411d29c7e\r\nCall-ID: 5-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 35, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 35, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 31, 64, 38, 31, 39, 39, 32, 39, 37, 62, 65, 62, 34, 33, 39, 32, 39, 31, 38, 30, 33, 33, 34, 34, 31, 31, 64, 32, 39, 63, 37, 65, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 35, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 49, 100, 56, 49, 57, 57, 50, 57, 55, 98, 101, 98, 52, 51, 57, 50, 57, 49, 56, 48, 51, 51, 52, 52, 49, 49, 100, 50, 57, 99, 55, 101]
Successfully parsed tag: tag-1d8199297beb43929180334411d29c7e
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:44.801583Z[0m [32m INFO[0m ThreadId(17) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-5-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-5-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-5-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-5-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag005")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-1d8199297beb43929180334411d29c7e")] })), CallId(CallId("5-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-5-7:BYE:server)
[2m2025-06-09T03:32:44.801904Z[0m [32m INFO[0m ThreadId(17) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-5-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
[2m2025-06-09T03:32:44.801997Z[0m [32m INFO[0m ThreadId(17) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog 26061721-e395-4a89-84fc-7fc6c9fa118a
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(26061721-e395-4a89-84fc-7fc6c9fa118a), reason: "BYE received" }
Sent StateChanged event result: Success
[2m2025-06-09T03:32:44.802049Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_bcd21e78-9eeb-4194-8528-c61b8b69b68c: 26061721-e395-4a89-84fc-7fc6c9fa118a - BYE received
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-6-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag006\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-f99a9ab526e04f28866318230f766862\r\nCall-ID: 6-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 36, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 36, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 66, 39, 39, 61, 39, 61, 62, 35, 32, 36, 65, 30, 34, 66, 32, 38, 38, 36, 36, 33, 31, 38, 32, 33, 30, 66, 37, 36, 36, 38, 36, 32, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 36, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 102, 57, 57, 97, 57, 97, 98, 53, 50, 54, 101, 48, 52, 102, 50, 56, 56, 54, 54, 51, 49, 56, 50, 51, 48, 102, 55, 54, 54, 56, 54, 50]
Successfully parsed tag: tag-f99a9ab526e04f28866318230f766862
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:45.298324Z[0m [32m INFO[0m ThreadId(12) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-6-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-6-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-6-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-6-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag006")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-f99a9ab526e04f28866318230f766862")] })), CallId(CallId("6-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-6-7:BYE:server)
[2m2025-06-09T03:32:45.298496Z[0m [32m INFO[0m ThreadId(12) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-6-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(b20ba681-e9e9-4055-94be-6114795f3982), reason: "BYE received" }
Valid state transition: Trying -> Completed
[2m2025-06-09T03:32:45.298584Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_a1d368a3-944d-4180-9ca6-4ac8bca37811: b20ba681-e9e9-4055-94be-6114795f3982 - BYE received
State successfully changed to: Completed
Sent StateChanged event result: Success
[2m2025-06-09T03:32:45.298546Z[0m [32m INFO[0m ThreadId(12) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog b20ba681-e9e9-4055-94be-6114795f3982
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-7-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag007\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-f77826359ee342b6b14c8e459d971135\r\nCall-ID: 7-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 37, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 37, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 66, 37, 37, 38, 32, 36, 33, 35, 39, 65, 65, 33, 34, 32, 62, 36, 62, 31, 34, 63, 38, 65, 34, 35, 39, 64, 39, 37, 31, 31, 33, 35, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 37, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 102, 55, 55, 56, 50, 54, 51, 53, 57, 101, 101, 51, 52, 50, 98, 54, 98, 49, 52, 99, 56, 101, 52, 53, 57, 100, 57, 55, 49, 49, 51, 53]
Successfully parsed tag: tag-f77826359ee342b6b14c8e459d971135
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:45.798599Z[0m [32m INFO[0m ThreadId(15) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-7-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-7-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-7-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-7-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag007")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-f77826359ee342b6b14c8e459d971135")] })), CallId(CallId("7-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-7-7:BYE:server)
[2m2025-06-09T03:32:45.798827Z[0m [32m INFO[0m ThreadId(15) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-7-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
[2m2025-06-09T03:32:45.798885Z[0m [32m INFO[0m ThreadId(15) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog fc3d557c-549e-4c84-a82d-9a9e19b4c5cb
Sent StateChanged event result: Success
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(fc3d557c-549e-4c84-a82d-9a9e19b4c5cb), reason: "BYE received" }
[2m2025-06-09T03:32:45.798953Z[0m [32m INFO[0m ThreadId(03) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_5a972db4-3ce8-4af7-8487-2cc4e117cb98: fc3d557c-549e-4c84-a82d-9a9e19b4c5cb - BYE received
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-8-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag008\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-1ef3a3f315a5421c87d5be9f93a93c22\r\nCall-ID: 8-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 38, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 38, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 31, 65, 66, 33, 61, 33, 66, 33, 31, 35, 61, 35, 34, 32, 31, 63, 38, 37, 64, 35, 62, 65, 39, 66, 39, 33, 61, 39, 33, 63, 32, 32, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 38, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 49, 101, 102, 51, 97, 51, 102, 51, 49, 53, 97, 53, 52, 50, 49, 99, 56, 55, 100, 53, 98, 101, 57, 102, 57, 51, 97, 57, 51, 99, 50, 50]
Successfully parsed tag: tag-1ef3a3f315a5421c87d5be9f93a93c22
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:46.299638Z[0m [32m INFO[0m ThreadId(13) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-8-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-8-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-8-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-8-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag008")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-1ef3a3f315a5421c87d5be9f93a93c22")] })), CallId(CallId("8-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-8-7:BYE:server)
[2m2025-06-09T03:32:46.299895Z[0m [32m INFO[0m ThreadId(13) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-8-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
Sent StateChanged event result: Success
[2m2025-06-09T03:32:46.299963Z[0m [32m INFO[0m ThreadId(13) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog ac04ede6-8a68-4595-af76-980ead4241c5
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(ac04ede6-8a68-4595-af76-980ead4241c5), reason: "BYE received" }
[2m2025-06-09T03:32:46.300033Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_53dab83c-b560-43e6-bc6e-cb180b2d4515: ac04ede6-8a68-4595-af76-980ead4241c5 - BYE received
=== PARSING SIP MESSAGE ===
Input length: 409 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-9-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag009\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-c4af7ef72ce5402db8a9ff3f093f1776\r\nCall-ID: 9-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 39, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 39, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 63, 34, 61, 66, 37, 65, 66, 37, 32, 63, 65, 35, 34, 30, 32, 64, 62, 38, 61, 39, 66, 66, 33, 66, 30, 39, 33, 66, 31, 37, 37, 36, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 39, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 99, 52, 97, 102, 55, 101, 102, 55, 50, 99, 101, 53, 52, 48, 50, 100, 98, 56, 97, 57, 102, 102, 51, 102, 48, 57, 51, 102, 49, 55, 55, 54]
Successfully parsed tag: tag-c4af7ef72ce5402db8a9ff3f093f1776
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:46.797552Z[0m [32m INFO[0m ThreadId(03) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-9-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-9-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-9-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-9-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag009")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-c4af7ef72ce5402db8a9ff3f093f1776")] })), CallId(CallId("9-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-9-7:BYE:server)
[2m2025-06-09T03:32:46.797692Z[0m [32m INFO[0m ThreadId(03) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-9-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(420789c3-e5e5-4430-854b-694044ffb2a8), reason: "BYE received" }
[2m2025-06-09T03:32:46.797732Z[0m [32m INFO[0m ThreadId(03) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog 420789c3-e5e5-4430-854b-694044ffb2a8
[2m2025-06-09T03:32:46.797768Z[0m [32m INFO[0m ThreadId(11) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_bd8a6b74-7dbc-4707-aa53-837c314df3de: 420789c3-e5e5-4430-854b-694044ffb2a8 - BYE received
State successfully changed to: Completed
Sent StateChanged event result: Success
=== PARSING SIP MESSAGE ===
Input length: 412 bytes
Input as string: "BYE sip:test@127.0.0.1:5062 SIP/2.0\r\nVia: SIP/2.0/UDP 127.0.0.1:5061;branch=z9hG4bK-31904-10-7\r\nFrom: SIPp Test <sip:sipp@127.0.0.1:5061>;tag=31904SIPpTag0010\r\nTo: Test User <sip:test@127.0.0.1:5062>;tag=tag-0feafe5a0d574d7b96f037808e7cd364\r\nCall-ID: 10-31904@127.0.0.1\r\nCSeq: 2 BYE\r\nContact: sip:sipp@127.0.0.1:5061\r\nMax-Forwards: 70\r\nSubject: SIPp Basic Call Test\r\nUser-Agent: SIPp/3.6.1\r\nContent-Length: 0\r\n\r\n"
Input as hex: [42, 59, 45, 20, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 2d, 33, 31, 39, 30, 34, 2d, 31, 30, 2d, 37, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 53, 49, 50, 70, 20, 54, 65, 73, 74, 20, 3c, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 3e, 3b, 74, 61, 67, 3d, 33, 31, 39, 30, 34, 53, 49, 50, 70, 54, 61, 67, 30, 30, 31, 30, 0d, 0a, 54, 6f, 3a, 20, 54, 65, 73, 74, 20, 55, 73, 65, 72, 20, 3c, 73, 69, 70, 3a, 74, 65, 73, 74, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 32, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 30, 66, 65, 61, 66, 65, 35, 61, 30, 64, 35, 37, 34, 64, 37, 62, 39, 36, 66, 30, 33, 37, 38, 30, 38, 65, 37, 63, 64, 33, 36, 34, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 31, 30, 2d, 33, 31, 39, 30, 34, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 0d, 0a, 43, 53, 65, 71, 3a, 20, 32, 20, 42, 59, 45, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 73, 69, 70, 3a, 73, 69, 70, 70, 40, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 31, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 53, 75, 62, 6a, 65, 63, 74, 3a, 20, 53, 49, 50, 70, 20, 42, 61, 73, 69, 63, 20, 43, 61, 6c, 6c, 20, 54, 65, 73, 74, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 53, 49, 50, 70, 2f, 33, 2e, 36, 2e, 31, 0d, 0a, 43, 6f, 6e, 74, 65, 6e, 74, 2d, 4c, 65, 6e, 67, 74, 68, 3a, 20, 30, 0d, 0a, 0d, 0a]
===========================
Attempting to parse tag from: [116, 97, 103, 61, 116, 97, 103, 45, 48, 102, 101, 97, 102, 101, 53, 97, 48, 100, 53, 55, 52, 100, 55, 98, 57, 54, 102, 48, 51, 55, 56, 48, 56, 101, 55, 99, 100, 51, 54, 52]
Successfully parsed tag: tag-0feafe5a0d574d7b96f037808e7cd364
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-09T03:32:47.301440Z[0m [32m INFO[0m ThreadId(14) [2mcrates/transaction-core/src/manager/mod.rs[0m[2m:[0m[2m2038:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bK-31904-10-7:BYE:server) [3mmethod[0m[2m=[0mBYE
Transaction loop starting for Key(z9hG4bK-31904-10-7:BYE:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bK-31904-10-7:BYE:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Bye, uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(127.0.0.1), sent_by_port: Some(5061), params: [Branch("z9hG4bK-31904-10-7")] }])), From(From(Address { display_name: Some("SIPp Test"), uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [Tag("31904SIPpTag0010")] })), To(To(Address { display_name: Some("Test User"), uri: Uri { scheme: Sip, user: Some("test"), password: None, host: Address(127.0.0.1), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-0feafe5a0d574d7b96f037808e7cd364")] })), CallId(CallId("10-31904@127.0.0.1")), CSeq(CSeq { seq: 2, method: Bye }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("sipp"), password: None, host: Address(127.0.0.1), port: Some(5061), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), MaxForwards(MaxForwards(70)), Subject(Subject("SIPp Basic Call Test")), UserAgent(["SIPp/3.6.1"]), ContentLength(ContentLength(0))], body: b"" })) for transaction Key(z9hG4bK-31904-10-7:BYE:server)
[2m2025-06-09T03:32:47.301779Z[0m [32m INFO[0m ThreadId(14) [2mcrates/sip-transport/src/transport/udp/mod.rs[0m[2m:[0m[2m162:[0m Sending response message to 127.0.0.1:5061
Received command: TransitionTo(Completed) for transaction Key(z9hG4bK-31904-10-7:BYE:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
📨 EVENT LOOP: Received session coordination event in background task
🎪 SESSION COORDINATION: Received event: CallTerminated { dialog_id: DialogId(5b5c90b4-8420-44da-adb1-f2534b1271b1), reason: "BYE received" }
[2m2025-06-09T03:32:47.301891Z[0m [32m INFO[0m ThreadId(14) [2mcrates/dialog-core/src/protocol/bye_handler.rs[0m[2m:[0m[2m106:[0m BYE processed for dialog 5b5c90b4-8420-44da-adb1-f2534b1271b1
Sent StateChanged event result: Success
[2m2025-06-09T03:32:47.301985Z[0m [32m INFO[0m ThreadId(17) [2mcrates/session-core/src/dialog/coordinator.rs[0m[2m:[0m[2m593:[0m Call terminated for session sess_f0104b0e-f7f0-4e14-995d-22bf285d1a08: 5b5c90b4-8420-44da-adb1-f2534b1271b1 - BYE received
[2m2025-06-09T03:32:47.427483Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m231:[0m 📡 Received SIGTERM signal
[2m2025-06-09T03:32:47.427511Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m210:[0m 🛑 SIP Test Server shutting down
[2m2025-06-09T03:32:47.427522Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m250:[0m 📊 Final Statistics:
[2m2025-06-09T03:32:47.427528Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m251:[0m   ⏱️  Uptime: 13.84 seconds
[2m2025-06-09T03:32:47.427536Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m252:[0m   📞 Total calls: 10
[2m2025-06-09T03:32:47.427541Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m253:[0m   ✅ Successful calls: 0
[2m2025-06-09T03:32:47.427546Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m254:[0m   ❌ Failed calls: 0
[2m2025-06-09T03:32:47.427550Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m255:[0m   🔄 Active calls: 10
[2m2025-06-09T03:32:47.427555Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m256:[0m   📈 Success rate: 0.0%
[2m2025-06-09T03:32:47.427560Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m260:[0m   🚀 Average call rate: 0.72 calls/second
[2m2025-06-09T03:32:47.427567Z[0m [32m INFO[0m ThreadId(01) [2mcrates/session-core/examples/sipp_tests/src/bin/sip_test_server.rs[0m[2m:[0m[2m298:[0m 👋 SIP Test Server shutdown complete

warning: unused import: `StaticEvent`
  --> crates/infra-common/src/events/static_path.rs:14:60
   |
14 | use crate::events::types::{Event, EventResult, EventError, StaticEvent, EventFilter};
   |                                                            ^^^^^^^^^^^
   |
   = note: `#[warn(unused_imports)]` on by default

warning: unused imports: `EventError` and `StaticEvent`
  --> crates/infra-common/src/events/system.rs:16:48
   |
16 | use crate::events::types::{Event, EventResult, EventError, EventFilter, StaticEvent};
   |                                                ^^^^^^^^^^               ^^^^^^^^^^^

warning: unused imports: `EventSystemBuilder` and `ImplementationType`
  --> crates/infra-common/src/events/system.rs:21:30
   |
21 | use crate::events::builder::{ImplementationType, EventSystemBuilder};
   |                              ^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^

warning: variable does not need to be mutable
  --> crates/infra-common/src/lifecycle/manager.rs:87:13
   |
87 |         let mut components = self.components.write().unwrap();
   |             ----^^^^^^^^^^
   |             |
   |             help: remove this `mut`
   |
   = note: `#[warn(unused_mut)]` on by default

warning: variable does not need to be mutable
   --> crates/infra-common/src/lifecycle/manager.rs:107:13
    |
107 |         let mut components = self.components.write().unwrap();
    |             ----^^^^^^^^^^
    |             |
    |             help: remove this `mut`

warning: variable does not need to be mutable
   --> crates/infra-common/src/lifecycle/manager.rs:127:13
    |
127 |         let mut components = self.components.write().unwrap();
    |             ----^^^^^^^^^^
    |             |
    |             help: remove this `mut`

warning: variable does not need to be mutable
   --> crates/infra-common/src/lifecycle/manager.rs:148:13
    |
148 |         let mut components = self.components.write().unwrap();
    |             ----^^^^^^^^^^
    |             |
    |             help: remove this `mut`

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:63:20
   |
63 |             config.merge(File::from(base_path.clone()))
   |                    ^^^^^
   |
   = note: `#[warn(deprecated)]` on by default

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:69:20
   |
69 |             config.merge(File::from(env_path))
   |                    ^^^^^

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:75:16
   |
75 |         config.merge(Environment::with_prefix(&env_prefix).separator("__"))
   |                ^^^^^

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
  --> crates/infra-common/src/config/loader.rs:97:16
   |
97 |         config.merge(Environment::with_prefix(&env_prefix).separator("__"))
   |                ^^^^^

warning: use of deprecated method `config::Config::merge`: please use 'ConfigBuilder' instead
   --> crates/infra-common/src/config/loader.rs:115:20
    |
115 |             config.merge(File::from(p.clone()))
    |                    ^^^^^

warning: methods `type_name` and `clone_sender` are never used
  --> crates/infra-common/src/events/registry.rs:37:8
   |
35 | trait AnyBroadcastSender: Send + Sync + 'static {
   |       ------------------ methods in this trait
36 |     fn as_any(&self) -> &dyn Any;
37 |     fn type_name(&self) -> &str;
   |        ^^^^^^^^^
38 |     fn clone_sender(&self) -> Box<dyn AnyBroadcastSender>;
   |        ^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` on by default

warning: fields `id`, `event_type`, and `priority` are never read
  --> crates/infra-common/src/events/subscriber.rs:11:16
   |
10 | pub struct SubscriberHandle {
   |            ---------------- fields in this struct
11 |     pub(crate) id: u64,
   |                ^^
12 |     pub(crate) event_type: EventType,
   |                ^^^^^^^^^^
13 |     pub(crate) priority: EventPriority,
   |                ^^^^^^^^
   |
   = note: `SubscriberHandle` has derived impls for the traits `Clone` and `Debug`, but these are intentionally ignored during dead code analysis

warning: method `handle_auto_options` is never used
   --> crates/dialog-core/src/manager/unified.rs:563:14
    |
197 | impl UnifiedDialogManager {
    | ------------------------- method in this implementation
...
563 |     async fn handle_auto_options(&self, request: Request, source: SocketAddr) -> ApiResult<()> {
    |              ^^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: method `extract_body_string` is never used
   --> crates/dialog-core/src/protocol/invite_handler.rs:177:8
    |
71  | impl DialogManager {
    | ------------------ method in this implementation
...
177 |     fn extract_body_string(&self, request: &Request) -> String {
    |        ^^^^^^^^^^^^^^^^^^^

üöÄ SIP REGISTER Without Auto-Response Demo

[2m2025-06-18T05:15:08.660525Z[0m [32m INFO[0m [2mrvoip_call_engine::database[0m[2m:[0m üóÑÔ∏è Creating in-memory Limbo database
[2m2025-06-18T05:15:08.671678Z[0m [32m INFO[0m [2mrvoip_call_engine::database[0m[2m:[0m ‚úÖ In-memory database created successfully
üîß Creating CallCenterEngine...
[2m2025-06-18T05:15:08.671796Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::core[0m[2m:[0m üöÄ Creating CallCenterEngine with session-core CallHandler integration
[2m2025-06-18T05:15:08.672332Z[0m [32m INFO[0m [2mrvoip_dialog_core::api::unified[0m[2m:[0m Creating UnifiedDialogApi with automatic transport setup in "Hybrid" mode
[2m2025-06-18T05:15:08.672838Z[0m [32m INFO[0m [2mrvoip_sip_transport::transport::udp[0m[2m:[0m SIP UDP transport bound to 0.0.0.0:5060
[2m2025-06-18T05:15:08.673663Z[0m [32m INFO[0m [2mrvoip_transaction_core::transport[0m[2m:[0m Added UDP transport bound to 0.0.0.0:5060
[2m2025-06-18T05:15:08.674102Z[0m [32m INFO[0m [2mrvoip_dialog_core::api::unified[0m[2m:[0m Creating UnifiedDialogApi with global events in "Hybrid" mode
[2m2025-06-18T05:15:08.674147Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Creating UnifiedDialogManager with global events in "Hybrid" mode at 0.0.0.0:5060
[2m2025-06-18T05:15:08.674182Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Creating new DialogManager with global transaction events and local address 0.0.0.0:5060
[2m2025-06-18T05:15:08.674283Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Setting unified configuration to "Hybrid" mode
[2m2025-06-18T05:15:08.674486Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m üîÑ Starting global transaction event processor for dialog-core
[2m2025-06-18T05:15:08.674780Z[0m [32m INFO[0m [2mrvoip_session_core::manager::events[0m[2m:[0m Session event processor started
üîó SETUP: Setting up session coordination with dialog-core
[2m2025-06-18T05:15:08.674800Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::api::unified[0m[2m:[0m Setting session coordinator
[2m2025-06-18T05:15:08.674807Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Session coordinator configured
‚úÖ SETUP: Session coordination setup complete
[2m2025-06-18T05:15:08.674824Z[0m [32m INFO[0m [2mrvoip_session_core::coordinator[0m[2m:[0m SessionCoordinator initialized on port 5060
[2m2025-06-18T05:15:08.674847Z[0m [32m INFO[0m [2mrvoip_dialog_core::api::unified[0m[2m:[0m Starting UnifiedDialogApi
[2m2025-06-18T05:15:08.674852Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Starting UnifiedDialogManager in "Hybrid" mode
üé¨ SPAWN: Starting session coordination event loop
[2m2025-06-18T05:15:08.674856Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m DialogManager starting
[2m2025-06-18T05:15:08.674864Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m DialogManager started successfully
[2m2025-06-18T05:15:08.674870Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Hybrid mode active - from_uri: Some("sip:user@localhost"), domain: None, auto_auth: false, auto_options: false
üì° EVENT LOOP: Session coordination event loop started
[2m2025-06-18T05:15:08.674886Z[0m [32m INFO[0m [2mrvoip_session_core::coordinator[0m[2m:[0m Starting main coordinator event loop
[2m2025-06-18T05:15:08.674902Z[0m [32m INFO[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m UnifiedDialogManager started successfully
[2m2025-06-18T05:15:08.674930Z[0m [32m INFO[0m [2mrvoip_session_core::manager::cleanup[0m[2m:[0m Cleanup manager started
[2m2025-06-18T05:15:08.674938Z[0m [32m INFO[0m [2mrvoip_session_core::coordinator[0m[2m:[0m SessionCoordinator started
[2m2025-06-18T05:15:08.674944Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::core[0m[2m:[0m ‚úÖ SessionCoordinator created with CallCenterCallHandler
[2m2025-06-18T05:15:08.675036Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::core[0m[2m:[0m ‚úÖ Call center engine initialized with session-core integration
üì° Starting event monitoring for REGISTER requests...
[2m2025-06-18T05:15:08.675048Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::core[0m[2m:[0m Starting session event monitoring for REGISTER and other events

‚úÖ System ready!

üìã Current Behavior:
  - dialog-core is configured WITHOUT auto_register_response
  - REGISTER requests are forwarded to CallCenterEngine
  - CallCenterEngine processes with SipRegistrar
  - Proper SIP responses are sent back

üìù When a REGISTER arrives:
  1. dialog-core receives it but doesn't auto-respond
  2. Event flows: dialog-core ‚Üí session-core ‚Üí CallCenterEngine
  3. SipRegistrar processes the registration
  4. CallCenterEngine sends proper 200 OK with Expires header
  5. Agent's endpoint receives the correct response

üîç Benefits:
  - Can validate agent credentials before accepting
  - Can send proper Contact headers in response
  - Can reject invalid registrations (404, 401, etc.)
  - Registration state is properly tracked

‚è≥ System running. Send REGISTER to port 5060...
   Press Ctrl+C to stop

=== PARSING SIP MESSAGE ===
Input length: 433 bytes
Input as string: "REGISTER sip:127.0.0.1:5060 SIP/2.0\r\nFrom: <sip:agent001@callcenter.example.com>;tag=tag-285b8f14ce6b423ea9e1ff03f6d9c9b0\r\nTo: <sip:agent001@callcenter.example.com>\r\nCall-ID: reg-28419-29fad12f-b2b3-4b1a-9b49-9f6c412bc095\r\nCSeq: 1 REGISTER\r\nContact: <sip:agent001@192.168.1.100:5062>\r\nExpires: 3600\r\nMax-Forwards: 70\r\nUser-Agent: RVoIP-SessionCore/1.0\r\nVia: SIP/2.0/UDP 0.0.0.0:5061;branch=z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20\r\n\r\n"
Input as hex: [52, 45, 47, 49, 53, 54, 45, 52, 20, 73, 69, 70, 3a, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 30, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 3c, 73, 69, 70, 3a, 61, 67, 65, 6e, 74, 30, 30, 31, 40, 63, 61, 6c, 6c, 63, 65, 6e, 74, 65, 72, 2e, 65, 78, 61, 6d, 70, 6c, 65, 2e, 63, 6f, 6d, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 32, 38, 35, 62, 38, 66, 31, 34, 63, 65, 36, 62, 34, 32, 33, 65, 61, 39, 65, 31, 66, 66, 30, 33, 66, 36, 64, 39, 63, 39, 62, 30, 0d, 0a, 54, 6f, 3a, 20, 3c, 73, 69, 70, 3a, 61, 67, 65, 6e, 74, 30, 30, 31, 40, 63, 61, 6c, 6c, 63, 65, 6e, 74, 65, 72, 2e, 65, 78, 61, 6d, 70, 6c, 65, 2e, 63, 6f, 6d, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 72, 65, 67, 2d, 32, 38, 34, 31, 39, 2d, 32, 39, 66, 61, 64, 31, 32, 66, 2d, 62, 32, 62, 33, 2d, 34, 62, 31, 61, 2d, 39, 62, 34, 39, 2d, 39, 66, 36, 63, 34, 31, 32, 62, 63, 30, 39, 35, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 52, 45, 47, 49, 53, 54, 45, 52, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 3c, 73, 69, 70, 3a, 61, 67, 65, 6e, 74, 30, 30, 31, 40, 31, 39, 32, 2e, 31, 36, 38, 2e, 31, 2e, 31, 30, 30, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 45, 78, 70, 69, 72, 65, 73, 3a, 20, 33, 36, 30, 30, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 52, 56, 6f, 49, 50, 2d, 53, 65, 73, 73, 69, 6f, 6e, 43, 6f, 72, 65, 2f, 31, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 30, 2e, 30, 2e, 30, 2e, 30, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 62, 31, 61, 64, 35, 34, 62, 35, 62, 62, 38, 36, 34, 34, 65, 31, 62, 32, 65, 31, 37, 66, 32, 61, 63, 62, 31, 39, 63, 64, 32, 30, 0d, 0a, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-18T05:15:11.553862Z[0m [32m INFO[0m [2mrvoip_transaction_core::manager[0m[2m:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server) [3mmethod[0m[2m=[0mREGISTER
[2m2025-06-18T05:15:11.553977Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Processing new incoming REGISTER request from transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554012Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Handling REGISTER request from 127.0.0.1:5061
Transaction loop starting for Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
Initial state: Trying
[2m2025-06-18T05:15:11.554056Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::protocol::register_handler[0m[2m:[0m Processing REGISTER request from 127.0.0.1:5061
Received command: TransitionTo(Trying) for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
[2m2025-06-18T05:15:11.554115Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::protocol::register_handler[0m[2m:[0m Forwarding REGISTER request to session layer (auto-response disabled)
Received command: ProcessMessage(Request(Request { method: Register, uri: Uri { scheme: Sip, user: None, password: None, host: Address(127.0.0.1), port: Some(5060), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [From(From(Address { display_name: None, uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Domain("callcenter.example.com"), port: None, parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-285b8f14ce6b423ea9e1ff03f6d9c9b0")] })), To(To(Address { display_name: None, uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Domain("callcenter.example.com"), port: None, parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("reg-28419-29fad12f-b2b3-4b1a-9b49-9f6c412bc095")), CSeq(CSeq { seq: 1, method: Register }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Address(192.168.1.100), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), Expires(Expires(3600)), MaxForwards(MaxForwards(70)), UserAgent(["RVoIP-SessionCore/1.0"]), Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(0.0.0.0), sent_by_port: Some(5061), params: [Branch("z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20")] }]))], body: b"" })) for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554131Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::protocol::register_handler[0m[2m:[0m REGISTER request processed
üì® EVENT LOOP: Received session coordination event in background task
üé™ SESSION COORDINATION: Received event: RegistrationRequest { transaction_id: z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server, from_uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Domain("callcenter.example.com"), port: None, parameters: [], headers: {}, raw_uri: None }, contact_uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Address(192.168.1.100), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, expires: 3600 }
[2m2025-06-18T05:15:11.554287Z[0m [32m INFO[0m [2mrvoip_session_core::dialog::coordinator[0m[2m:[0m Registration request: sip:agent001@callcenter.example.com -> sip:agent001@192.168.1.100:5062 (expires: 3600)
üéØ COORDINATOR: Handling event: RegistrationRequest { transaction_id: "Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)", from_uri: "sip:agent001@callcenter.example.com", contact_uri: "sip:agent001@192.168.1.100:5062", expires: 3600 }
[2m2025-06-18T05:15:11.554377Z[0m [32m INFO[0m [2mrvoip_session_core::coordinator[0m[2m:[0m REGISTER request forwarded to application: sip:agent001@callcenter.example.com -> sip:agent001@192.168.1.100:5062 (expires: 3600)
[2m2025-06-18T05:15:11.554397Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::core[0m[2m:[0m Received REGISTER request: sip:agent001@callcenter.example.com -> sip:agent001@192.168.1.100:5062 (expires: 3600)
[2m2025-06-18T05:15:11.554405Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m Processing REGISTER: transaction=Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server), from=sip:agent001@callcenter.example.com, contact=sip:agent001@192.168.1.100:5062, expires=3600
[2m2025-06-18T05:15:11.554560Z[0m [32m INFO[0m [2mrvoip_call_engine::agent::registration[0m[2m:[0m ‚úÖ New registration for sip:agent001@callcenter.example.com: expires in 3600s
[2m2025-06-18T05:15:11.554582Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m REGISTER processed: Created for sip:agent001@callcenter.example.com
[2m2025-06-18T05:15:11.554596Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m Sending 200 OK for successful registration
[2m2025-06-18T05:15:11.554634Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Sending status response 200 OK for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554645Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Building response for transaction 200 OK with status Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554750Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Successfully built response for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server) using proper RFC 3261 compliant headers
[2m2025-06-18T05:15:11.554761Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Sending response for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554784Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::transaction_integration[0m[2m:[0m Sending response 200 for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554842Z[0m [32m INFO[0m [2mrvoip_sip_transport::transport::udp[0m[2m:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-18T05:15:11.554946Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::transaction_integration[0m[2m:[0m Successfully sent response for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
[2m2025-06-18T05:15:11.554958Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m REGISTER response sent: 200 Registration successful
Received command: TransitionTo(Completed) for transaction Key(z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
Sent StateChanged event result: Success
[2m2025-06-18T05:15:11.555025Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Received unassociated transaction event: StateChanged { transaction_id: z9hG4bKb1ad54b5bb8644e1b2e17f2acb19cd20:REGISTER:server, previous_state: Trying, new_state: Completed }
=== PARSING SIP MESSAGE ===
Input length: 430 bytes
Input as string: "REGISTER sip:127.0.0.1:5060 SIP/2.0\r\nFrom: <sip:agent001@callcenter.example.com>;tag=tag-478897a5bf3242129512bb9cda59c3c3\r\nTo: <sip:agent001@callcenter.example.com>\r\nCall-ID: reg-28419-0968ca6b-8bfa-4eeb-9159-c408d1fa8be0\r\nCSeq: 1 REGISTER\r\nContact: <sip:agent001@192.168.1.100:5062>\r\nExpires: 0\r\nMax-Forwards: 70\r\nUser-Agent: RVoIP-SessionCore/1.0\r\nVia: SIP/2.0/UDP 0.0.0.0:5061;branch=z9hG4bKeed21fae04fe425589c9a1501a8e4e8d\r\n\r\n"
Input as hex: [52, 45, 47, 49, 53, 54, 45, 52, 20, 73, 69, 70, 3a, 31, 32, 37, 2e, 30, 2e, 30, 2e, 31, 3a, 35, 30, 36, 30, 20, 53, 49, 50, 2f, 32, 2e, 30, 0d, 0a, 46, 72, 6f, 6d, 3a, 20, 3c, 73, 69, 70, 3a, 61, 67, 65, 6e, 74, 30, 30, 31, 40, 63, 61, 6c, 6c, 63, 65, 6e, 74, 65, 72, 2e, 65, 78, 61, 6d, 70, 6c, 65, 2e, 63, 6f, 6d, 3e, 3b, 74, 61, 67, 3d, 74, 61, 67, 2d, 34, 37, 38, 38, 39, 37, 61, 35, 62, 66, 33, 32, 34, 32, 31, 32, 39, 35, 31, 32, 62, 62, 39, 63, 64, 61, 35, 39, 63, 33, 63, 33, 0d, 0a, 54, 6f, 3a, 20, 3c, 73, 69, 70, 3a, 61, 67, 65, 6e, 74, 30, 30, 31, 40, 63, 61, 6c, 6c, 63, 65, 6e, 74, 65, 72, 2e, 65, 78, 61, 6d, 70, 6c, 65, 2e, 63, 6f, 6d, 3e, 0d, 0a, 43, 61, 6c, 6c, 2d, 49, 44, 3a, 20, 72, 65, 67, 2d, 32, 38, 34, 31, 39, 2d, 30, 39, 36, 38, 63, 61, 36, 62, 2d, 38, 62, 66, 61, 2d, 34, 65, 65, 62, 2d, 39, 31, 35, 39, 2d, 63, 34, 30, 38, 64, 31, 66, 61, 38, 62, 65, 30, 0d, 0a, 43, 53, 65, 71, 3a, 20, 31, 20, 52, 45, 47, 49, 53, 54, 45, 52, 0d, 0a, 43, 6f, 6e, 74, 61, 63, 74, 3a, 20, 3c, 73, 69, 70, 3a, 61, 67, 65, 6e, 74, 30, 30, 31, 40, 31, 39, 32, 2e, 31, 36, 38, 2e, 31, 2e, 31, 30, 30, 3a, 35, 30, 36, 32, 3e, 0d, 0a, 45, 78, 70, 69, 72, 65, 73, 3a, 20, 30, 0d, 0a, 4d, 61, 78, 2d, 46, 6f, 72, 77, 61, 72, 64, 73, 3a, 20, 37, 30, 0d, 0a, 55, 73, 65, 72, 2d, 41, 67, 65, 6e, 74, 3a, 20, 52, 56, 6f, 49, 50, 2d, 53, 65, 73, 73, 69, 6f, 6e, 43, 6f, 72, 65, 2f, 31, 2e, 30, 0d, 0a, 56, 69, 61, 3a, 20, 53, 49, 50, 2f, 32, 2e, 30, 2f, 55, 44, 50, 20, 30, 2e, 30, 2e, 30, 2e, 30, 3a, 35, 30, 36, 31, 3b, 62, 72, 61, 6e, 63, 68, 3d, 7a, 39, 68, 47, 34, 62, 4b, 65, 65, 64, 32, 31, 66, 61, 65, 30, 34, 66, 65, 34, 32, 35, 35, 38, 39, 63, 39, 61, 31, 35, 30, 31, 61, 38, 65, 34, 65, 38, 64, 0d, 0a, 0d, 0a]
===========================
=== PARSE SUCCESS ===
Successfully parsed message
=====================
[2m2025-06-18T05:15:13.670424Z[0m [32m INFO[0m [2mrvoip_transaction_core::manager[0m[2m:[0m Created new ServerNonInviteTransaction [3mid[0m[2m=[0mKey(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server) [3mmethod[0m[2m=[0mREGISTER
[2m2025-06-18T05:15:13.671125Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Processing new incoming REGISTER request from transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
[2m2025-06-18T05:15:13.671316Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Handling REGISTER request from 127.0.0.1:5061
[2m2025-06-18T05:15:13.671358Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::protocol::register_handler[0m[2m:[0m Processing REGISTER request from 127.0.0.1:5061
[2m2025-06-18T05:15:13.671670Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::protocol::register_handler[0m[2m:[0m Forwarding REGISTER request to session layer (auto-response disabled)
Transaction loop starting for Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
Initial state: Trying
Received command: TransitionTo(Trying) for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
Processing TransitionTo(Trying) current state: Trying
Already in requested state, no transition needed: Trying
Received command: ProcessMessage(Request(Request { method: Register, uri: Uri { scheme: Sip, user: None, password: None, host: Address(127.0.0.1), port: Some(5060), parameters: [], headers: {}, raw_uri: None }, version: Version { major: 2, minor: 0 }, headers: [From(From(Address { display_name: None, uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Domain("callcenter.example.com"), port: None, parameters: [], headers: {}, raw_uri: None }, params: [Tag("tag-478897a5bf3242129512bb9cda59c3c3")] })), To(To(Address { display_name: None, uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Domain("callcenter.example.com"), port: None, parameters: [], headers: {}, raw_uri: None }, params: [] })), CallId(CallId("reg-28419-0968ca6b-8bfa-4eeb-9159-c408d1fa8be0")), CSeq(CSeq { seq: 1, method: Register }), Contact(Contact([Params([ContactParamInfo { address: Address { display_name: None, uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Address(192.168.1.100), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, params: [] } }])])), Expires(Expires(0)), MaxForwards(MaxForwards(70)), UserAgent(["RVoIP-SessionCore/1.0"]), Via(Via([ViaHeader { sent_protocol: SentProtocol { name: "SIP", version: "2.0", transport: "UDP" }, sent_by_host: Address(0.0.0.0), sent_by_port: Some(5061), params: [Branch("z9hG4bKeed21fae04fe425589c9a1501a8e4e8d")] }]))], body: b"" })) for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
üì® EVENT LOOP: Received session coordination event in background task
üé™ SESSION COORDINATION: Received event: RegistrationRequest { transaction_id: z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server, from_uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Domain("callcenter.example.com"), port: None, parameters: [], headers: {}, raw_uri: None }, contact_uri: Uri { scheme: Sip, user: Some("agent001"), password: None, host: Address(192.168.1.100), port: Some(5062), parameters: [], headers: {}, raw_uri: None }, expires: 0 }
[2m2025-06-18T05:15:13.672107Z[0m [32m INFO[0m [2mrvoip_session_core::dialog::coordinator[0m[2m:[0m Registration request: sip:agent001@callcenter.example.com -> sip:agent001@192.168.1.100:5062 (expires: 0)
[2m2025-06-18T05:15:13.671731Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::protocol::register_handler[0m[2m:[0m REGISTER request processed
üéØ COORDINATOR: Handling event: RegistrationRequest { transaction_id: "Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)", from_uri: "sip:agent001@callcenter.example.com", contact_uri: "sip:agent001@192.168.1.100:5062", expires: 0 }
[2m2025-06-18T05:15:13.672490Z[0m [32m INFO[0m [2mrvoip_session_core::coordinator[0m[2m:[0m REGISTER request forwarded to application: sip:agent001@callcenter.example.com -> sip:agent001@192.168.1.100:5062 (expires: 0)
[2m2025-06-18T05:15:13.672595Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::core[0m[2m:[0m Received REGISTER request: sip:agent001@callcenter.example.com -> sip:agent001@192.168.1.100:5062 (expires: 0)
[2m2025-06-18T05:15:13.672618Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m Processing REGISTER: transaction=Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server), from=sip:agent001@callcenter.example.com, contact=sip:agent001@192.168.1.100:5062, expires=0
[2m2025-06-18T05:15:13.672738Z[0m [32m INFO[0m [2mrvoip_call_engine::agent::registration[0m[2m:[0m üì§ De-registration request for sip:agent001@callcenter.example.com
[2m2025-06-18T05:15:13.672788Z[0m [32m INFO[0m [2mrvoip_call_engine::agent::registration[0m[2m:[0m üóëÔ∏è Removed registration for sip:agent001@callcenter.example.com
[2m2025-06-18T05:15:13.672805Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m REGISTER processed: Removed for sip:agent001@callcenter.example.com
[2m2025-06-18T05:15:13.672821Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m Sending 200 OK for de-registration
[2m2025-06-18T05:15:13.672850Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Sending status response 200 OK for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
[2m2025-06-18T05:15:13.672868Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Building response for transaction 200 OK with status Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
[2m2025-06-18T05:15:13.673053Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Successfully built response for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server) using proper RFC 3261 compliant headers
[2m2025-06-18T05:15:13.673081Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::unified[0m[2m:[0m Sending response for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
[2m2025-06-18T05:15:13.673095Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::transaction_integration[0m[2m:[0m Sending response 200 for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
[2m2025-06-18T05:15:13.673242Z[0m [32m INFO[0m [2mrvoip_sip_transport::transport::udp[0m[2m:[0m Sending response message to 127.0.0.1:5061
[2m2025-06-18T05:15:13.673494Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::transaction_integration[0m[2m:[0m Successfully sent response for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
[2m2025-06-18T05:15:13.673529Z[0m [32m INFO[0m [2mrvoip_call_engine::orchestrator::handler[0m[2m:[0m REGISTER response sent: 200 De-registration successful
Received command: TransitionTo(Completed) for transaction Key(z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server)
Processing TransitionTo(Completed) current state: Trying
Valid state transition: Trying -> Completed
State successfully changed to: Completed
Sent StateChanged event result: Success
[2m2025-06-18T05:15:13.673749Z[0m [34mDEBUG[0m [2mrvoip_dialog_core::manager::core[0m[2m:[0m Received unassociated transaction event: StateChanged { transaction_id: z9hG4bKeed21fae04fe425589c9a1501a8e4e8d:REGISTER:server, previous_state: Trying, new_state: Completed }
